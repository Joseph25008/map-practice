/*! PGWeb3DMilitary.min.js v13.0.7998.30605 - (c) PilotGaea - BuildDate:2021/11/24 17:01:10 */
(function(){var b=function(a){this._Result=a;this._Ok=!1};b.prototype._ParseResult=function(){};b.prototype.IsOk=function(){return this._Ok};b.prototype.GetResultStruct=function(){return IsString(this._Result)?JSON.parse(this._Result):null};var c=function(a,d){this._Url=d;this._TerrainLayerName=a};c.prototype._InitParameter=function(a){};c.prototype._GetUrl=function(){};c.prototype.GetResult=function(a,d){};this.CMilitaryAnalysisResult=b;this.CMilitaryAnalysis=c}).call(this);

(function(){var c=function(a){SUPERCLASS_CONSTRUCT(CMilitaryAnalysisResult,this,a);this._Result=a;this._Ok=!1;this._FlightPathPolyline=null;this._ParseResult()};DEFINE_INHERITANCE(c,CMilitaryAnalysisResult);c.prototype._ParseResult=function(){var a=this.GetResultStruct();if(a&&a.path&&0<a.path.length){var b=new GeoPolyline;b.FromGeoJSON(a.path[0]);this._Ok=!0;this._FlightPathPolyline=b}else this._Ok=!1,this._FlightPathPolyline=null};c.prototype.GetFlightPathPolyline=function(){return this._FlightPathPolyline};
var d=function(a,b){this._Url=b;this._TerrainLayerName=a;this._Begin=new Geo3DPoint;this._End=new Geo3DPoint;this._EV=this._MaxFlyDistance=this._DemHeight=this._DemWidth=this._GridSize=this._NeedPathCount=this._SafeDelta=this._MinHeightAboveGround=this._VertScale=this._AngleOfClimb=this._HorzR=this._MaxHeight=this._MinHeight=this._Radars=null};d.prototype._InitParameter=function(a){this._Url=Default(a.url,this._Url);this._Begin=Default(a.begin,this._Begin);this._End=Default(a.end,this._End);this._Radars=
Default(a.radars,this._Radars,IsArray);this._MinHeight=Default(a.minHeight,this._MinHeight,IsNumber);this._MaxHeight=Default(a.maxHeight,this._MaxHeight,IsNumber);this._HorzR=Default(a.horzr,this._HorzR,IsNumber);this._AngleOfClimb=Default(a.angleOfClimb,this._AngleOfClimb,IsNumber);this._VertScale=Default(a.vertScale,this._VertScale,IsNumber);this._MinHeightAboveGround=Default(a.minHeightAboveGround,this._MinHeightAboveGround,IsNumber);this._SafeDelta=Default(a.safeDelta,this._SafeDelta,IsNumber);
this._NeedPathCount=Default(a.needPathCount,this._NeedPathCount,IsNumber);this._GridSize=Default(a.gridSize,this._GridSize,IsNumber);this._DemWidth=Default(a.demWidth,this._DemWidth,IsNumber);this._DemHeight=Default(a.demHeight,this._DemHeight,IsNumber)};d.prototype._GetUrl=function(){var a=this._Url+"/military?request=FlightPath&StartP="+this._Begin.x+","+this._Begin.y+","+this._Begin.z+"&DestP="+this._End.x+","+this._End.y+","+this._End.z+"&Terrain="+this._TerrainLayerName;this._MinHeight&&(a+=
"&MinHeight="+this._MinHeight);this._MaxHeight&&(a+="&MaxHeight="+this._MaxHeight);this._HorzR&&(a+="&HorzR="+this._HorzR);this._AngleOfClimb&&(a+="&AngleOfClimb="+this._AngleOfClimb);this._VertScale&&(a+="&VertScale="+this._VertScale);this._MinHeightAboveGround&&(a+="&MinHeightAboveGround="+this._MinHeightAboveGround);this._SafeDelta&&(a+="&SafeDelta="+this._SafeDelta);this._MaxFlyDistance&&(a+="&MaxFlyDistance="+this._MaxFlyDistance);this._EV&&(a+="&EV="+this._EV);this._NeedPathCount&&(a+="&NeedPathCount="+
this._NeedPathCount);this._GridSize&&(a+="&GridSize="+this._GridSize);this._DemWidth&&(a+="&DemWidth="+this._DemWidth);this._DemHeight&&(a+="&DemHeight="+this._DemHeight);return a};d.prototype.GetResult=function(a,b){this._InitParameter(a);(new CFileLoader).GetText_Post(this._GetUrl(),this._Radars,function(e,f,g){b(new c(e))}.bind(this))};this.CFlightPathAnalysis=d}).call(this);

(function(){var d=function(a){SUPERCLASS_CONSTRUCT(CMilitaryAnalysisResult,this,a);this._MaskBoundary=new GeoBoundary;this._MaskBitmap=null;this._MaskHeight=this._MaskWidth=0;this._ParseResult()};DEFINE_INHERITANCE(d,CMilitaryAnalysisResult);d.prototype._ParseResult=function(){var a=this.GetResultStruct();a&&a.success?(this._Ok=!0,this._MaskBoundary.west=a.boundary[0],this._MaskBoundary.south=a.boundary[1],this._MaskBoundary.east=a.boundary[2],this._MaskBoundary.north=a.boundary[3],this._MaskBitmap=
a.mask,this._MaskWidth=a.width,this._MaskHeight=a.height):(this._Ok=!1,this._MaskBitmap=null,this._MaskHeight=this._MaskWidth=0)};d.prototype.GetMaskBoundary=function(){return this._MaskBoundary};d.prototype.GetMaskBitmap=function(){return this._MaskBitmap};d.prototype.GetMaskWidth=function(){return this._MaskWidth};d.prototype.GetMaskHeight=function(){return this._MaskHeight};var e=function(a,c){SUPERCLASS_CONSTRUCT(CMilitaryAnalysis,this,a,c);this._Center=new Geo3DPoint;this._GridSize=this._AbsHeight=
this._Threshold=this._EndArg=this._StartArg=this._Radius=null;this._PlaneCenter=0;this._ExtendAngle=360;this._ViewScale=0};DEFINE_INHERITANCE(e,CMilitaryAnalysis);e.prototype._InitParameter=function(a){this._Url=Default(a.url,this._Url,IsString);this._Center=Default(a.geo,this._Center);this._Radius=Default(a.radius,this._Radius,IsNumber);this._StartArg=Default(a.startArg,this._StartArg,IsNumber);this._EndArg=Default(a.endArg,this._EndArg,IsNumber);this._Threshold=Default(a.threshold,this._Threshold,
IsNumber);this._AbsHeight=Default(a.absHeight,this._AbsHeight,IsNumber);this._GridSize=Default(a.gridSize,this._GridSize,IsNumber);this._PlaneCenter=Default(a.planeCenter,this._PlaneCenter,IsNumber);this._ExtendAngle=Default(a.extendAngle,this._ExtendAngle,IsNumber);this._ViewScale=Default(a.viewScale,this._ViewScale,IsNumber)};e.prototype._GetUrl=function(){var a=this._Url+"/military?request=Viewshed&Point="+this._Center.x+","+this._Center.y+","+this._Center.z;this._TerrainLayerName&&(a+="&Terrain="+
this._TerrainLayerName);this._Radius&&(a+="&Radius="+this._Radius);this._StartArg&&(a+="&StartArg="+this._StartArg);this._EndArg&&(a+="&EndArg="+this._EndArg);this._Threshold&&(a+="&Threshold="+this._Threshold);this._AbsHeight&&(a+="&AbsHeight="+this._AbsHeight);this._GridSize&&(a+="&GridSize="+this._GridSize);this._PlaneCenter&&(a+="&PlaneCenter="+this._PlaneCenter);this._ExtendAngle&&(a+="&ExtendAngle="+this._ExtendAngle);this._ViewScale&&(a+="&ViewScale="+this._ViewScale);return a};e.prototype._GetBoundary=
function(){var a=new GeoPoint(this._Center);GetEPSGEngine().Transfer(4326,3826,a);var c=new GeoPoint(a);a=new GeoPoint(a);var b=this._Radius+this._GridSize/2;c.x-=b;c.y-=b;a.x+=b;a.y+=b;GetEPSGEngine().Transfer(3826,4326,c);GetEPSGEngine().Transfer(3826,4326,a);return[c.x,c.y,a.x,a.y]};e.prototype._GetMask=function(a){var c=[],b=document.createElement("canvas");b.width=a.width;b.height=a.height;b=b.getContext("2d");b.drawImage(a,0,0);a=b.getImageData(0,0,a.width,a.height);for(b=0;b<a.data.length;b++)c.push(a.data[b]);
return c};e.prototype.GetResult=function(a,c){this._InitParameter(a);(new CFileLoader).GetImage(this._GetUrl(),function(b){var f={};null!==b&&0<b.width&&0<b.height?(f.width=b.width,f.height=b.height,f.mask=this._GetMask(b),f.success=!0,f.boundary=this._GetBoundary()):f.success=!1;c(new d(JSON.stringify(f),b))}.bind(this))};this.CRadar2DAnalysis=e}).call(this);

(function(){var d=function(a){SUPERCLASS_CONSTRUCT(CMilitaryAnalysisResult,this,a);this._TrianglesPoint=null;this._ParseResult()};DEFINE_INHERITANCE(d,CMilitaryAnalysisResult);d.prototype._ParseResult=function(){var a=this.GetResultStruct();if(a&&a.success&&a.Points){this._Ok=!0;for(var b=[],f=a.Indexs.length/3,e=0;e<f;e++){for(var g=[],h=0;3>h;h++){var l=a.Points[a.Indexs[3*e+h]],k=new GeoPoint;k.FromGeoJSON(l);g.push(k)}b.push(g)}this._TrianglesPoint=b}else this._Ok=!1,this._TrianglesPoint=null};
d.prototype.GetTrianglesPoint=function(){return this._TrianglesPoint};var c=function(a,b){SUPERCLASS_CONSTRUCT(CMilitaryAnalysis,this,a,b);this._Center=new Geo3DPoint;this._GridSize=this._AbsHeight=this._Threshold=this._EndArg=this._StartArg=this._Radius=null;this._PlaneCenter=0;this._ExtendAngle=180};DEFINE_INHERITANCE(c,CMilitaryAnalysis);c.prototype._InitParameter=function(a){this._Url=Default(a.url,this._Url,IsString);this._Center=Default(a.geo,this._Center);this._Radius=Default(a.radius,this._Radius,
IsNumber);this._StartArg=Default(a.startArg,this._StartArg,IsNumber);this._EndArg=Default(a.endArg,this._EndArg,IsNumber);this._Threshold=Default(a.threshold,this._Threshold,IsNumber);this._AbsHeight=Default(a.absHeight,this._AbsHeight,IsNumber);this._GridSize=Default(a.gridSize,this._GridSize,IsNumber);this._PlaneCenter=Default(a.planeCenter,this._PlaneCenter,IsNumber);this._ExtendAngle=Default(a.extendAngle,this._ExtendAngle,IsNumber)};c.prototype._GetUrl=function(){var a=this._Url+"/military?request=Viewshed3D&Point="+
this._Center.x+","+this._Center.y+","+this._Center.z+"&Radius="+this._Radius+"&Terrain="+this._TerrainLayerName;null!==this._StartArg&&(a+="&StartArg="+this._StartArg);null!==this._EndArg&&(a+="&EndArg="+this._EndArg);null!==this._Threshold&&(a+="&Threshold="+this._Threshold);null!==this._AbsHeight&&(a+="&AbsHeight="+this._AbsHeight);null!==this._GridSize&&(a+="&GridSize="+this._GridSize);null!==this._PlaneCenter&&(a+="&PlaneCenter="+this._PlaneCenter);null!==this._ExtendAngle&&(a+="&ExtendAngle="+
this._ExtendAngle);return a};c.prototype.GetResult=function(a,b){this._InitParameter(a);(new CFileLoader).GetText(this._GetUrl(),function(f,e,g){b(new d(f))}.bind(this))};this.CRadar3DAnalysis=c}).call(this);

(function(){var d=function(a,b,c){SUPERCLASS_CONSTRUCT(CCustomEntity,this,a,b,c);this._Opacity=1;this._MaskBoundary=this._MaskHeight=this._MaskWidth=0;this._MaskTexture=this._MaskBitmap=null;this._ViewColor=new GLCOLOR("#00FF00");this._UnviewColor=new GLCOLOR("#FF0000");this._UnviewOpacity=this._ViewOpacity=.5;this.UpdateParameter(c)};DEFINE_INHERITANCE(d,CCustomEntity);d.prototype.UpdateParameter=function(a){var b=Default(a.opacity,void 0,IsNumber),c=Default(a.maskBitmap,void 0,IsArray),e=Default(a.maskWidth,
void 0,IsNumber),k=Default(a.maskHeight,void 0,IsNumber),l=Default(a.maskBoundary,void 0),m=Default(a.viewColor,void 0,IsString),h=Default(a.unviewColor,void 0,IsString),f=Default(a.viewOpacity,void 0,IsNumber);a=Default(a.unviewOpacity,void 0,IsNumber);this._Opacity=Default(b,this._Opacity);this._MaskWidth=Default(e,this._MaskWidth);this._MaskHeight=Default(k,this._MaskHeight);this._MaskBoundary=Default(l,this._MaskBoundary);this._ViewOpacity=Default(f,this._ViewOpacity);this._UnviewOpacity=Default(a,
this._UnviewOpacity);this._InitParameter(c,m,h);this._Layer.TerrainEngine.UpdateScreen()};d.prototype._InitDraw=function(a){null===this._MaskTexture&&null!==this._MaskBitmap&&(this._MaskTexture=a.CreateTextureByOptions({Buffer:this._MaskBitmap,Type:ENUM_GL.UNSIGNED_BYTE,Width:this._MaskWidth,Height:this._MaskHeight,MinFilter:ENUM_GL.NEAREST,MagFilter:ENUM_GL.NEAREST,FlipY:!0}))};d.prototype.Draw=function(a,b,c){};d.prototype.DrawTerrainSurfaceEffects=function(a,b,c){this._InitDraw(a);if(null!==this._MaskTexture){b=
this._Layer.Radar2DSurfaceShader;var e=this._Layer.TerrainSurfaceMesh,k=new Matrix4,l=new Matrix4,m=new Matrix4;a.BindTexture(0,this._MaskTexture);b.UseProgram();b.Uniforms.Boundary.set(this._MaskBoundary.west,this._MaskBoundary.south,this._MaskBoundary.east,this._MaskBoundary.north);b.Uniforms.ViewColor.set(this._ViewColor.r,this._ViewColor.g,this._ViewColor.b,this._ViewOpacity);b.Uniforms.UnviewColor.set(this._UnviewColor.r,this._UnviewColor.g,this._UnviewColor.b,this._UnviewOpacity);b.Uniforms.EccentricitySquared.set(this._Layer.TerrainEngine.SphericalCoordinateConvert.GetEccentricitySquared());
if(e)for(var h=0;h<e.length;h++){var f=e[h],g=f.Offset;m.setTranslate(g.x-c.Pos.x,g.y-c.Pos.y,g.z-c.Pos.z);l.set(a.ViewMatrix).multiply(m);k.set(a.ProjectionMatrix).multiply(l);b.Uniforms.matWorldViewProj.setValue(k.elements);b.Uniforms.Offset.set(g.x,g.y,g.z);a.BindIndiceBuffer(f.IndexBuffer);a.BindVertexBuffer(f.VertexBuffers.Input_p);b.VertexAttribPointer(b.AttribLocations.Input_p,3,ENUM_GL.FLOAT,!1,0,0);a.DrawElements(ENUM_PRIMITIVE.TRIANGLES,0,f.IndexCount)}}};d.prototype.GetType=function(){return CUSTDRAW_ENTITY_TYPE.RADER_2D_SURFACE};
d.prototype._InitParameter=function(a,b,c){if(a){this._MaskBitmap=new Uint8Array(this._MaskWidth*this._MaskHeight*4);for(var e=0;e<a.length;e++)this._MaskBitmap[e]=a[e];this._ClearResources()}b&&(this._ViewColor=new GLCOLOR(b));c&&(this._UnviewColor=new GLCOLOR(c))};d.prototype._ClearResources=function(){this._MaskTexture&&(this._MaskTexture.Release(),this._MaskTexture=null)};d.prototype.DeInit=function(){this._ClearResources();CCustomEntity.prototype.DeInit.call(this)};this.CCustomRadar2DSurface=
d}).call(this);

(function(){var e=function(a,b,c){SUPERCLASS_CONSTRUCT(CCustomEntity,this,a,b,c);this._Center=new Geo3DPoint;this._CenterWorldXYZ=new Geo3DPoint;this._PlaneCenter=0;this._ExtendAngle=360;this._Frequency=8E3;this._EffectiveRadiatedPower=53;this._Radius=2E5;this._Opacity=1;this._Gains=[];this._MaskHeight=this._MaskWidth=0;this._MaskBoundary=new GeoBoundary;this._MaskTexture=this._MaskBitmap=null;this._StrengthTable=[-120.01,-120,-90,-60,-30,0,.01,999999.99];this._ColorTable=[new GLCOLOR("#000000"),
new GLCOLOR("#0000FF"),new GLCOLOR("#008000"),new GLCOLOR("#FFFF00"),new GLCOLOR("#FFA500"),new GLCOLOR("#FF0000"),new GLCOLOR("#9F9719"),new GLCOLOR("#9F9719")];this._GainsTableTexture=null;this._InitGains();this.UpdateParameter(c)};DEFINE_INHERITANCE(e,CCustomEntity);e.prototype._InitGains=function(){this._Gains=[30,29.4,28.8,28.2,27.6,27,26.4,25.8,25.2,24.6,24,23.4,22.8,22.2,21.6,21,20.4,19.8,19.2,18.6,18,17.4,16.8,16.2,15.6,15,14.4,13.8,13.2,12.6,12,11.4,10.8,10.2,9.6,9,8.4,7.8,7.2,6.6,6,5.4,
4.8,4.2,3.6,3,2.4,1.8,1.2,.6,0,.6,1.2,1.8,2.4,3,3.6,4.2,4.8,5.4,6,6.6,7.2,7.8,8.4,9,9.6,10.2,10.8,11.4,12,12.6,13.2,13.8,14.4,15,14.4,13.8,13.2,12.6,12,11.4,10.8,10.2,9.6,9,8.4,7.8,7.2,6.6,6,5.4,4.8,4.2,3.6,3,2.4,1.8,1.2,.6,0,.6,1.2,1.8,2.4,3,3.6,4.2,4.8,5.4,6,6.6,7.2,7.8,8.4,9,8.4,7.8,7.2,6.6,6,5.4,4.8,4.2,3.6,3,2.4,1.8,1.2,.6,0,.6,1.2,1.8,2.4,3,3.6,4.2,4.8,5.4,6,-.6,-1.2,-1.8,-2.4,-3,-3.6,-4.2,-4.8,-5.4,-6,0,0,0,0,0,.2,.4,.6,.8,1,1.2,1.4,1.6,1.8,2,2.2,2.4,2.6,2.8,3,3.2,3.4,3.6,3.8,4,4.2,4.4,4.6,
4.8,5]};e.prototype.UpdateParameter=function(a){var b=a.geo,c=Default(a.radius,void 0,IsNumber),f=Default(a.planeCenter,void 0,IsNumber),h=Default(a.extendAngle,void 0,IsNumber),m=Default(a.frequency,void 0,IsNumber),d=Default(a.effectiveRadiatedPower,void 0,IsNumber),n=Default(a.opacity,void 0,IsNumber),k=Default(a.gains,void 0,IsArray),l=Default(a.strengthTable,void 0,IsArray),g=Default(a.colorTable,void 0,IsArray),p=Default(a.useViewShed,void 0,IsBool),q=Default(a.maskBitmap,void 0,IsArray),r=
Default(a.maskWidth,void 0,IsNumber),t=Default(a.maskHeight,void 0,IsNumber);a=Default(a.maskBoundary,void 0);this._Center=Default(b,this._Center);this._Radius=Default(c,this._Radius);this._PlaneCenter=Default(f,this._PlaneCenter);this._ExtendAngle=Default(h,this._ExtendAngle);this._Frequency=Default(m,this._Frequency);this._EffectiveRadiatedPower=Default(d,this._EffectiveRadiatedPower);this._Opacity=Default(n,this._Opacity);this._UseViewShed=Default(p,this._UseViewShed);this._MaskWidth=Default(r,
this._MaskWidth);this._MaskHeight=Default(t,this._MaskHeight);this._MaskBoundary=Default(a,this._MaskBoundary);this._InitParameter(b,k,l,g,q);this._Layer.TerrainEngine.UpdateScreen()};e.prototype._InitDraw=function(a){if(null===this._GainsTableTexture){for(var b=new Float32Array(724),c=Math.min(this._Gains.length,181),f=0;f<c;f++)b[4*f]=this._Gains[f];this._GainsTableTexture=a.CreateTextureByOptions({Buffer:b,Type:ENUM_GL.FLOAT,Width:181,Height:1,MinFilter:ENUM_GL.LINEAR,MagFilter:ENUM_GL.LINEAR})}null===
this._MaskTexture&&null!==this._MaskBitmap&&(this._MaskTexture=a.CreateTextureByOptions({Buffer:this._MaskBitmap,Type:ENUM_GL.UNSIGNED_BYTE,Width:this._MaskWidth,Height:this._MaskHeight,MinFilter:ENUM_GL.NEAREST,MagFilter:ENUM_GL.NEAREST,FlipY:!0}))};e.prototype.Draw=function(a,b,c){};e.prototype.DrawTerrainSurfaceEffects=function(a,b,c){this._InitDraw(a);b=this._Layer.FieldStrengthShader;var f=this._Layer.TerrainSurfaceMesh,h=new Matrix4,m=new Matrix4,d=new Matrix4,n=new Matrix4;this._Layer.TerrainEngine.SphericalCoordinateConvert.GetWorldXYZToWorldMapMatrix(this._CenterWorldXYZ,
d);a.BindTexture(0,this._GainsTableTexture);a.BindTexture(1,this._MaskTexture);b.UseProgram();b.Uniforms.matField.setValue(d.elements);b.Uniforms.FieldRadius.set(this._Radius);b.Uniforms.Frequency.set(this._Frequency);b.Uniforms.PlaneCenter.set(this._PlaneCenter);b.Uniforms.Opacity.set(this._Opacity);b.Uniforms.EffectiveRadiatedPower.set(this._EffectiveRadiatedPower);b.Uniforms.ExtendAngle.set(this._ExtendAngle);b.Uniforms.Boundary.set(this._MaskBoundary.west,this._MaskBoundary.south,this._MaskBoundary.east,
this._MaskBoundary.north);b.Uniforms.UseViewShed.set(this._UseViewShed);b.Uniforms.EccentricitySquared.set(this._Layer.TerrainEngine.SphericalCoordinateConvert.GetEccentricitySquared());b.Uniforms.GainMap.set(0);b.Uniforms.Mask.set(1);for(d=0;d<this._StrengthTable.length;d++)b.Uniforms.StrengthArray[d].set(this._StrengthTable[d]);for(d=0;d<this._ColorTable.length;d++)b.Uniforms.ColorArray[d].set(this._ColorTable[d].r,this._ColorTable[d].g,this._ColorTable[d].b,this._ColorTable[d].a);if(f)for(d=0;d<
f.length;d++){var k=f[d],l=this._CenterWorldXYZ,g=k.Offset;n.setTranslate(g.x-c.Pos.x,g.y-c.Pos.y,g.z-c.Pos.z);m.set(a.ViewMatrix).multiply(n);h.set(a.ProjectionMatrix).multiply(m);b.Uniforms.matWorldViewProj.setValue(h.elements);b.Uniforms.FieldRelativeNode.set(g.x-l.x,g.y-l.y,g.z-l.z);b.Uniforms.Offset.set(g.x,g.y,g.z);a.BindIndiceBuffer(k.IndexBuffer);a.BindVertexBuffer(k.VertexBuffers.Input_p);b.VertexAttribPointer(b.AttribLocations.Input_p,3,ENUM_GL.FLOAT,!1,0,0);a.DrawElements(ENUM_PRIMITIVE.TRIANGLES,
0,k.IndexCount)}};e.prototype.DeInit=function(){this._ClearResources();CCustomEntity.prototype.DeInit.call(this)};e.prototype._ClearResources=function(){this._GainsTableTexture&&(this._GainsTableTexture.Release(),this._GainsTableTexture=null);this._MaskTexture&&(this._MaskTexture.Release(),this._MaskTexture=null)};e.prototype.GetType=function(){return CUSTDRAW_ENTITY_TYPE.FIELD_STRENGTH};e.prototype._InitParameter=function(a,b,c,f,h){a&&this._SetGeo(a);b&&this._SetGains(b);c&&this._SetStrengthTable(c);
f&&this._SetColorTable(f);if(h){this._MaskBitmap=new Uint8Array(this._MaskWidth*this._MaskHeight*4);for(a=0;a<h.length;a++)this._MaskBitmap[a]=h[a];this._ClearResources()}};e.prototype._SetGains=function(a){for(var b=Math.min(a.length,181),c=0;c<b;c++)this._Gains[c]=a[c];this._ClearResources()};e.prototype._SetStrengthTable=function(a){for(var b=Math.min(a.length,16),c=0;c<b;c++)this._StrengthTable[c]=a[c]};e.prototype._SetColorTable=function(a){for(var b=Math.min(a.length,16),c=0;c<b;c++)this._ColorTable[c]=
new GLCOLOR(a[c])};e.prototype._SetGeo=function(a){this._Center=new Geo3DPoint(a);this._CenterWorldXYZ=new Geo3DPoint(a);this._Layer.TerrainEngine.MapToWorldMap(this._CenterWorldXYZ);this._Layer.TerrainEngine.WorldMapToWorldXYZ(this._CenterWorldXYZ)};this.CCustomFieldStrengthSurface=e}).call(this);

(function(){var m=function(a,e,h){SUPERCLASS_CONSTRUCT(CCustomEntity,this,a,e,h);this._PositionWorldMap=this._OriginalGeo=null;this._Radius=1;this._Color=new GLCOLOR(0,0,1,1);this._ScanColor=new GLCOLOR(1,.65,0,1);this._Opacity=this._ScanOpacity=.3;this._ScanLineOpacity=1;this._LineOpacity=.8;this._SphereMeshDetailY=this._SphereMeshDetailX=30;this._AbsHeight=this._DrawLine=!0;this._VertArg=this._HorzArg=1;this._PlaneCenter=0;this._ScanRightPower=this._ScanLeftPower=20;this._ScanPosition=0;this._ScanSpeed=
.1;this._ScanLastUpdateTime=Date.now();this._ScanEasing=ENUM_BASIC_EASING.LINEAR;this._ScanPlaying=!0;this._WireframeSurroundBoxVerticalIndexCount=this._WireframeSurroundBoxHorizonIndexCount=this._WireframeSurfaceInnerIndexCount=this._WireframeSurfaceIndexCount=this._FaceSurroundBoxVerticalIndexCount=this._FaceSurroundBoxHorizonIndexCount=this._FaceSurfaceInnerIndexCount=this._FaceSurfaceIndexCount=this._SurroundBoxVertexCount=this._SurfaceVertexCount=this._WireframeIndexBuffer=this._FaceIndexBuffer=
this._VertexBuffer=null;this.UpdateParameter(h)};DEFINE_INHERITANCE(m,CCustomEntity);m.prototype.UpdateParameter=function(a){var e=a.geo,h=Default(a.color,void 0,IsString),l=Default(a.scanColor,void 0,IsString),k=Default(a.opacity,void 0,IsNumber),n=Default(a.scanOpacity,void 0,IsNumber),f=Default(a.lineOpacity,void 0,IsNumber),c=Default(a.scanLineOpacity,void 0,IsNumber),d=Default(a.radius,void 0,IsNumber),b=Default(a.sphereDetailX,void 0,IsNumber),g=Default(a.sphereDetailY,void 0,IsNumber),r=Default(a.drawLine,
void 0,IsBool),t=Default(a.absHeight,void 0,IsBool),p=Default(a.horzArg,void 0,IsNumber),q=Default(a.vertArg,void 0,IsNumber),u=Default(a.planeCenter,void 0,IsNumber),v=Default(a.scanPlay,void 0,IsBool),w=Default(a.scanPosition,void 0,IsNumber),x=Default(a.scanLeftFactor,void 0,IsNumber),y=Default(a.scanRightFactor,void 0,IsNumber),z=Default(a.scanSpeed,void 0,IsNumber);a=Default(a.scanEasing,void 0,IsFunction);this._OriginalGeo=Default(e,this._OriginalGeo);this._Color=Default(h,this._Color);this._ScanColor=
Default(l,this._ScanColor);this._Opacity=Default(k,this._Opacity);this._ScanOpacity=Default(n,this._ScanOpacity);this._LineOpacity=Default(f,this._LineOpacity);this._ScanLineOpacity=Default(c,this._ScanLineOpacity);this._Radius=Default(d,this._Radius);this._DrawLine=Default(r,this._DrawLine);this._AbsHeight=Default(t,this._AbsHeight);this._HorzArg=Default(p,this._HorzArg);this._VertArg=Default(q,this._VertArg);this._PlaneCenter=Default(u,this._PlaneCenter);this._ScanPosition=Default(w,this._ScanPosition);
this._ScanPlaying=Default(v,this._ScanPlaying);this._ScanLeftPower=Default(x,this._ScanLeftPower);this._ScanRightPower=Default(y,this._ScanRightPower);this._ScanSpeed=Default(z,this._ScanSpeed);this._ScanEasing=Default(a,this._ScanEasing);this._InitParameter(e,p,q,b,g,h,l);this._Layer.TerrainEngine.UpdateScreen()};m.prototype._GetScanNeedReverse=function(){return 1!==this._HorzArg&&0===Math.floor(this._ScanPosition)%2};m.prototype._GetScanPosition=function(){var a=Date.now(),e=(a-this._ScanLastUpdateTime)/
1E3*this._ScanSpeed;this._ScanPosition+=this._ScanPlaying?e:0;this._ScanLastUpdateTime=a;a=this._ScanPosition-Math.floor(this._ScanPosition);return this._ScanEasing(this._GetScanNeedReverse()?1-a:a)};m.prototype._GetWorldViewProjMatrix=function(a,e,h,l){var k=this._GetWorldXYZCenter().Sub(a.Pos),n=new Matrix4;this._Layer.TerrainEngine.SphericalCoordinateConvert.GetWorldMapToWorldXYZMatrix(this._PositionWorldMap,n);var f=new Matrix4;f.scale(this._Radius,this._Radius,this._Radius);var c=new Matrix4;
c.rotate(90-this._PlaneCenter,0,0,1);a=new Matrix4;a.setTranslate(k.x,k.y,k.z);a.multiply(n);a.multiply(f);a.multiply(c);a.multiply(e);e=new Matrix4;e.set(l).multiply(h).multiply(a);return e};m.prototype._GetWorldXYZCenter=function(){var a=new Geo3DPoint(this._PositionWorldMap);if(!this._AbsHeight){var e=this._Layer.TerrainEngine.GetHeight(this._PositionWorldMap);a.z=e+a.z}this._Layer.TerrainEngine.WorldMapToWorldXYZ(a);return a};m.prototype._IsNeedDrawBoxHorizon=function(){return 1!==this._VertArg};
m.prototype._IsNeedDrawBoxVertical=function(){return 1!==this._HorzArg};m.prototype._DrawWireframe=function(a){if(this._DrawLine){var e=this._WireframeSurfaceInnerIndexCount+this._WireframeSurfaceIndexCount,h=this._WireframeSurfaceInnerIndexCount+this._WireframeSurfaceIndexCount+this._WireframeSurroundBoxHorizonIndexCount;a.BindIndiceBuffer(this._WireframeIndexBuffer);this._Layer.RadarAnimeShader.Uniforms.SurfaceColor.set(this._Color.r,this._Color.g,this._Color.b,this._LineOpacity);this._Layer.RadarAnimeShader.Uniforms.SurfaceScanColor.set(this._ScanColor.r,
this._ScanColor.g,this._ScanColor.b,this._ScanLineOpacity);this._IsNeedDrawBoxHorizon()&&a.DrawElements(ENUM_PRIMITIVE.LINES,e,this._WireframeSurroundBoxHorizonIndexCount,ENUM_GL.UNSIGNED_INT);this._IsNeedDrawBoxVertical()&&a.DrawElements(ENUM_PRIMITIVE.LINES,h,this._WireframeSurroundBoxVerticalIndexCount,ENUM_GL.UNSIGNED_INT);a.DrawElements(ENUM_PRIMITIVE.LINES,0,this._WireframeSurfaceIndexCount+this._WireframeSurfaceInnerIndexCount,ENUM_GL.UNSIGNED_INT)}};m.prototype._DrawFace=function(a){var e=
this._FaceSurfaceInnerIndexCount+this._FaceSurfaceIndexCount,h=this._FaceSurfaceInnerIndexCount+this._FaceSurfaceIndexCount+this._FaceSurroundBoxHorizonIndexCount;a.BindIndiceBuffer(this._FaceIndexBuffer);this._Layer.RadarAnimeShader.Uniforms.SurfaceColor.set(this._Color.r,this._Color.g,this._Color.b,this._Opacity);this._Layer.RadarAnimeShader.Uniforms.SurfaceScanColor.set(this._ScanColor.r,this._ScanColor.g,this._ScanColor.b,this._ScanOpacity);a.EnableDepthWritable(!1);a.SetCullType(ENUM_CULL_TYPE.CCW);
this._IsNeedDrawBoxHorizon()&&a.DrawElements(ENUM_PRIMITIVE.TRIANGLES,e,this._FaceSurroundBoxHorizonIndexCount,ENUM_GL.UNSIGNED_INT);this._IsNeedDrawBoxVertical()&&a.DrawElements(ENUM_PRIMITIVE.TRIANGLES,h,this._FaceSurroundBoxVerticalIndexCount,ENUM_GL.UNSIGNED_INT);a.SetCullType(ENUM_CULL_TYPE.CW);this._IsNeedDrawBoxHorizon()&&a.DrawElements(ENUM_PRIMITIVE.TRIANGLES,e,this._FaceSurroundBoxHorizonIndexCount,ENUM_GL.UNSIGNED_INT);this._IsNeedDrawBoxVertical()&&a.DrawElements(ENUM_PRIMITIVE.TRIANGLES,
h,this._FaceSurroundBoxVerticalIndexCount,ENUM_GL.UNSIGNED_INT);a.EnableDepthWritable(!1);a.SetCullType(ENUM_CULL_TYPE.CW);a.DrawElements(ENUM_PRIMITIVE.TRIANGLES,0,this._FaceSurfaceIndexCount+this._FaceSurfaceInnerIndexCount,ENUM_GL.UNSIGNED_INT);a.SetCullType(ENUM_CULL_TYPE.CCW);a.DrawElements(ENUM_PRIMITIVE.TRIANGLES,0,this._FaceSurfaceIndexCount+this._FaceSurfaceInnerIndexCount,ENUM_GL.UNSIGNED_INT);a.EnableDepthWritable(!0)};m.prototype.Draw=function(a,e,h){this.InitDraw(a);var l=.5*this._HorzArg,
k=.5*this._VertArg;e=this._GetWorldViewProjMatrix(h,e,a.ViewMatrix,a.ProjectionMatrix);a.BindVertexBuffer(this._VertexBuffer);this._Layer.RadarAnimeShader.UseProgram();this._Layer.RadarAnimeShader.DisableAllVertexAttrib();this._Layer.RadarAnimeShader.VertexAttribPointer(this._Layer.RadarAnimeShader.AttribLocations.Input_p,3,ENUM_GL.FLOAT,!1,0,0);this._Layer.RadarAnimeShader.Uniforms.matWorldViewProj.setValue(e.elements);this._Layer.RadarAnimeShader.Uniforms.ScanPosition.set(this._GetScanPosition());
this._Layer.RadarAnimeShader.Uniforms.ScanPower.set(this._ScanLeftPower,this._ScanRightPower);this._Layer.RadarAnimeShader.Uniforms.LongitudeRange.set(-l,l);this._Layer.RadarAnimeShader.Uniforms.LatitudeRange.set(.5-k,.5+k);this._Layer.RadarAnimeShader.Uniforms.RadiusRange.set(0,1);this._DrawWireframe(a);this._DrawFace(a);this._Layer.TerrainEngine.UpdateScreen()};m.prototype.DeInit=function(){this._ClearResources();CCustomEntity.prototype.DeInit.call(this)};m.prototype._ClearResources=function(){this._VertexBuffer&&
(this._VertexBuffer.Release(),this._VertexBuffer=null);this._WireframeIndexBuffer&&(this._WireframeIndexBuffer.Release(),this._WireframeIndexBuffer=null);this._FaceIndexBuffer&&(this._FaceIndexBuffer.Release(),this._FaceIndexBuffer=null)};m.prototype.GetType=function(){return CUSTDRAW_ENTITY_TYPE.RADAR_ANIME};m.prototype._InitParameter=function(a,e,h,l,k,n,f){a&&this.SetGeo(this._OriginalGeo);e&&(this._HorzArg/=360);h&&(this._VertArg/=180);n&&(this._Color=new GLCOLOR(this._Color));f&&(this._ScanColor=
new GLCOLOR(this._ScanColor));if(IsNumber(l)||IsNumber(k))this._ClearResources(),this._SphereMeshDetailX=Default(l,this._SphereMeshDetailX,IsNumber),this._SphereMeshDetailY=Default(k,this._SphereMeshDetailY,IsNumber)};m.prototype._GetFaceIndex=function(){for(var a=this._SphereMeshDetailX,e=this._SphereMeshDetailY,h=a*e*6,l=a*e*6,k=12*a,n=12*e,f=(a+1)*(e+1),c=0,d=new Uint32Array(h+l+k+n),b=0;b<e;b++)for(var g=0;g<a;g++)d[c++]=g+(b+0)*(a+1)+0,d[c++]=g+(b+0)*(a+1)+1,d[c++]=g+(b+1)*(a+1)+0,d[c++]=g+(b+
1)*(a+1)+0,d[c++]=g+(b+0)*(a+1)+1,d[c++]=g+(b+1)*(a+1)+1;for(b=0;b<e;b++)for(g=0;g<a;g++)d[c++]=g+(b+0)*(a+1)+0+f,d[c++]=g+(b+0)*(a+1)+1+f,d[c++]=g+(b+1)*(a+1)+0+f,d[c++]=g+(b+1)*(a+1)+0+f,d[c++]=g+(b+0)*(a+1)+1+f,d[c++]=g+(b+1)*(a+1)+1+f;for(b=0;b<a;b++)d[c++]=b+0,d[c++]=b+0+f,d[c++]=b+1,d[c++]=b+1,d[c++]=b+0+f,d[c++]=b+1+f,d[c++]=e*(a+1)+(b+0),d[c++]=e*(a+1)+(b+0)+f,d[c++]=e*(a+1)+(b+1),d[c++]=e*(a+1)+(b+1),d[c++]=e*(a+1)+(b+0)+f,d[c++]=e*(a+1)+(b+1)+f;for(b=0;b<e;b++)d[c++]=(b+0)*(a+1),d[c++]=
(b+0)*(a+1)+f,d[c++]=(b+1)*(a+1),d[c++]=(b+1)*(a+1),d[c++]=(b+0)*(a+1)+f,d[c++]=(b+1)*(a+1)+f,d[c++]=(b+0)*(a+1)+a,d[c++]=(b+0)*(a+1)+a+f,d[c++]=(b+1)*(a+1)+a,d[c++]=(b+1)*(a+1)+a,d[c++]=(b+0)*(a+1)+a+f,d[c++]=(b+1)*(a+1)+a+f;this._FaceSurfaceIndexCount=h;this._FaceSurfaceInnerIndexCount=l;this._FaceSurroundBoxHorizonIndexCount=k;this._FaceSurroundBoxVerticalIndexCount=n;return d};m.prototype._GetWireframeIndex=function(){for(var a=this._SphereMeshDetailX,e=this._SphereMeshDetailY,h=a*e*8,l=a*e*8,
k=4*(a+1),n=4*(e+1),f=(a+1)*(e+1),c=0,d=new Uint32Array(h+l+k+n),b=0;b<e;b++)for(var g=0;g<a;g++)d[c++]=g+b*(a+1)+0,d[c++]=g+b*(a+1)+1,d[c++]=g+(b+0)*(a+1),d[c++]=g+(b+1)*(a+1),d[c++]=g+(b+0)*(a+1)+1,d[c++]=g+(b+1)*(a+1)+1,d[c++]=g+(b+1)*(a+1)+0,d[c++]=g+(b+1)*(a+1)+1;for(b=0;b<e;b++)for(g=0;g<a;g++)d[c++]=g+b*(a+1)+0+f,d[c++]=g+b*(a+1)+1+f,d[c++]=g+(b+0)*(a+1)+f,d[c++]=g+(b+1)*(a+1)+f,d[c++]=g+(b+0)*(a+1)+1+f,d[c++]=g+(b+1)*(a+1)+1+f,d[c++]=g+(b+1)*(a+1)+0+f,d[c++]=g+(b+1)*(a+1)+1+f;for(b=0;b<a+
1;b++)d[c++]=b,d[c++]=b+f,d[c++]=e*(a+1)+b,d[c++]=e*(a+1)+b+f;for(b=0;b<e+1;b++)d[c++]=b*(a+1),d[c++]=b*(a+1)+f,d[c++]=b*(a+1)+a,d[c++]=b*(a+1)+a+f;this._WireframeSurfaceIndexCount=h;this._WireframeSurfaceInnerIndexCount=l;this._WireframeSurroundBoxHorizonIndexCount=k;this._WireframeSurroundBoxVerticalIndexCount=n;return d};m.prototype._GetSphereVertex=function(){for(var a=this._SphereMeshDetailX,e=this._SphereMeshDetailY,h=(a+1)*(e+1)*2,l=0,k=new Float32Array(3*h),n=0;n<e+1;n++)for(var f=0;f<a+1;f++)k[l++]=
f/a,k[l++]=n/e,k[l++]=1;for(n=0;n<e+1;n++)for(f=0;f<a+1;f++)k[l++]=f/a,k[l++]=n/e,k[l++]=0;this._SurfaceVertexCount=h;return k};m.prototype.InitDraw=function(a){null===this._VertexBuffer&&(this._VertexBuffer=a.CreateVertexBuffer(ENUM_GL.STATIC_DRAW,ENUM_FVF.XYZ,this._GetSphereVertex()));null===this._WireframeIndexBuffer&&(this._WireframeIndexBuffer=a.CreateIndexBuffer(ENUM_GL.STATIC_DRAW,this._GetWireframeIndex()));null===this._FaceIndexBuffer&&(this._FaceIndexBuffer=a.CreateIndexBuffer(ENUM_GL.STATIC_DRAW,
this._GetFaceIndex()))};m.prototype.SetGeo=function(a){this._OriginalGeo=new Geo3DPoint(a);this._PositionWorldMap=new Geo3DPoint(a);this._Layer.TerrainEngine.MapToWorldMap(this._PositionWorldMap)};this.CCustomRadarAnime=m}).call(this);

(function(){var d=function(a,c,b){SUPERCLASS_CONSTRUCT(CCustomEntity,this,a,c,b);this._Point=null;this._Size=48;this._PointWorldMap=this._PointWorldXYZ=null;this._AbsHeight=!0;this._SymbolImageUrl=null;this.UpdateParameter(b)};DEFINE_INHERITANCE(d,CCustomEntity);d.prototype.UpdateParameter=function(a){var c=a.geo,b=Default(a.size,void 0,IsNumber),e=Default(a.absHeight,void 0,IsBool);a=Default(a.symbol,void 0,IsString);this._Point=Default(c,this._Point);this._Size=Default(b,this._Size);this._AbsHeight=
Default(e,this._AbsHeight);this._SymbolImageUrl=Default(a,this._SymbolImageUrl);this._InitParameter(c,b,a);this._Layer.TerrainEngine.UpdateScreen()};d.prototype._UpdatePointHeight=function(){this._AbsHeight||(this._PointWorldXYZ.CopyFrom(this._PointWorldMap),this._PointWorldXYZ.z+=this._Layer.TerrainEngine.GetHeight(this._PointWorldMap),this._Layer.TerrainEngine.WorldMapToWorldXYZ(this._PointWorldXYZ))};d.prototype.Draw=function(a,c,b){};d.prototype.DrawSymbolPoint=function(a,c,b){if(c=this._Layer.SymbolTexturePool.GetSymbolTexture(this._SymbolImageUrl))this._UpdatePointHeight(),
this._Layer.SymbolPointShader.Uniforms.Size.set(this._Size),this._Layer.SymbolPointShader.Uniforms.Offset.set(this._PointWorldXYZ.x-b.Pos.x,this._PointWorldXYZ.y-b.Pos.y,this._PointWorldXYZ.z-b.Pos.z),a.BindTexture(0,c),a.DrawArrays(ENUM_PRIMITIVE.POINTS,0,1)};d.prototype.GetType=function(){return CUSTDRAW_ENTITY_TYPE.SYMBOL_POINT};d.prototype._InitParameter=function(a,c,b){a&&(this._Point=new GeoPoint(this._Point),this._SetGeo(this._Point));c&&(this._Size=c);IsString(b)&&this._Layer.SymbolTexturePool.CreateSymbolTexture(b)};
d.prototype._SetGeo=function(a){this._PointWorldXYZ=new Geo3DPoint(a);this._Layer.TerrainEngine.MapToWorldMap(this._PointWorldXYZ);this._PointWorldMap=new Geo3DPoint(this._PointWorldXYZ);this._Layer.TerrainEngine.WorldMapToWorldXYZ(this._PointWorldXYZ)};this.CCustomSymbolPoint=d}).call(this);

(function(){var d=function(b,a,c){SUPERCLASS_CONSTRUCT(CCustomTriangleSet,this,b,a,c)};DEFINE_INHERITANCE(d,CCustomTriangleSet);d.prototype.GetType=function(){return CUSTDRAW_ENTITY_TYPE.TRANSPARENT_TRIANGLESET};d.prototype.Draw=function(b,a,c){this.InitDraw(b);a=this._TerrainEngine.DefaultDrawShader;b.SetCullType(ENUM_CULL_TYPE.NONE);a.SetConstColor(0,new GLCOLOR(this._DrawColor.r,this._DrawColor.g,this._DrawColor.b,1));a.SetColorArg1(0,ENUM_TSS_ARG.TFACTOR);a.SetAlphaArg1(0,ENUM_TSS_ARG.TFACTOR);
a.SetAlphaOp(0,ENUM_TSS_OP.SELECTARG1);a.SetColorOp(0,ENUM_TSS_OP.SELECTARG1);a.SetColorOp(1,ENUM_TSS_OP.DISABLE);a.SetColorOp(2,ENUM_TSS_OP.DISABLE);a.SetColorOp(3,ENUM_TSS_OP.DISABLE);c=this._Offset.Sub(c.Pos);var e=new Matrix4;e.setTranslate(c.x,c.y,c.z);b.SetWorldMatrix(e);a.UseProgram();b.BindVertexBuffer(this._VertexBuffer);b.BindIndiceBuffer(this._IndexBuffer);b.DisableAllVertexAttrib();a.VertexAttribPointer(a.AttribLocations.Input_p,3,ENUM_GL.FLOAT,!1,32,0);a.VertexAttribPointer(a.AttribLocations.Input_normal,
3,ENUM_GL.FLOAT,!1,32,12);a.VertexAttribPointer(a.AttribLocations.Input_tp1,2,ENUM_GL.FLOAT,!1,32,24);a.SetConstColor(0,new GLCOLOR(this._DrawColor.r,this._DrawColor.g,this._DrawColor.b,this._DrawOpacity));b.DrawElements(ENUM_PRIMITIVE.LINES,0,2*this._TrianglePointWorldMap.length);a.SetConstColor(0,new GLCOLOR(this._FillColor.r,this._FillColor.g,this._FillColor.b,this._FillOpacity));b.EnableColorWritable(!1,!1,!1,!1);b.DrawArrays(ENUM_PRIMITIVE.TRIANGLES,0,this._TrianglePointWorldMap.length);b.EnableColorWritable(!0,
!0,!0,!0);b.DrawArrays(ENUM_PRIMITIVE.TRIANGLES,0,this._TrianglePointWorldMap.length)};this.CCustomTransparentTriangleSet=d}).call(this);

(function(){var c=function(a){this._SymbolImage=[];this._SymbolTexture=new CMap;this._TerrainEngine=a};c.prototype.CreateSymbolTexture=function(a){this._SymbolTexture.HasKey(a)||(this._SymbolTexture.SetAt(a,null),(new CFileLoader).GetImage(a,function(b){b&&this._SymbolImage.push({SymbolUrl:a,SymbolImage:b});this._TerrainEngine.UpdateScreen()},this))};c.prototype.GetSymbolTexture=function(a){return this._SymbolTexture.GetAt(a)};c.prototype.InitSymbolTexture=function(a){for(var b=0;b<this._SymbolImage.length;b++){var d=
a.CreateTextureByOptions({Src:this._SymbolImage[b].SymbolImage,MinFilter:ENUM_GL.LINEAR_MIPMAP_LINEAR});this._SymbolTexture.SetAt(this._SymbolImage[b].SymbolUrl,d)}this._SymbolImage=[]};this.CSymbolTexturePool=c}).call(this);

(function(){var b=function(a,d){SUPERCLASS_CONSTRUCT(CCustomLayer,this,a,d);this.FieldStrengthShader=new f(a);this.SymbolPointShader=new g(a);this.RadarAnimeShader=new h(a);this.Radar2DSurfaceShader=new k(a);this.SymbolTexturePool=new CSymbolTexturePool(a);this.TerrainSurfaceMesh=this._SymbolPointVertexBuffer=null;this.FieldStrengthShader.Init(this.TerrainEngine.Device);this.SymbolPointShader.Init(this.TerrainEngine.Device);this.RadarAnimeShader.Init(this.TerrainEngine.Device);this.Radar2DSurfaceShader.Init(this.TerrainEngine.Device)};
DEFINE_INHERITANCE(b,CCustomLayer);b.prototype.AddFieldStrengthEntity=function(a){a=new CCustomFieldStrengthSurface(this,this.TerrainEngine,a);a.BindToken(this.GetIdManager().CreateToken());this._Entities.push(a);return a};b.prototype.AddSymbolPointEntity=function(a){a=new CCustomSymbolPoint(this,this.TerrainEngine,a);a.BindToken(this.GetIdManager().CreateToken());this._Entities.push(a);return a};b.prototype.AddRadar2DSurface=function(a){a=new CCustomRadar2DSurface(this,this.TerrainEngine,a);a.BindToken(this.GetIdManager().CreateToken());
this._Entities.push(a);return a};b.prototype.AddRadarAnimeEntity=function(a){a=new CCustomRadarAnime(this,this.TerrainEngine,a);a.BindToken(this.GetIdManager().CreateToken());this._Entities.push(a);return a};b.prototype.AddTransparentTriangleSetEntity=function(a){a=new CCustomTransparentTriangleSet(this,this.TerrainEngine,a);a.BindToken(this.GetIdManager().CreateToken());this._Entities.push(a);return a};b.prototype._InitDrawTerrainSurfaceEffects=function(a){this.TerrainSurfaceMesh=this.TerrainEngine.TerrainLayer.GetCurrentDrawNodesMesh()};
b.prototype.DrawTerrainSurfaceEffects=function(a,d,e){if(this.Show){this._InitDrawTerrainSurfaceEffects(a);for(var c=0;c<this._Entities.length;c++)this._Entities[c].IsShow()&&this._Entities[c].DrawTerrainSurfaceEffects(a,d,e)}};b.prototype._InitDrawSymbolPoint=function(a){this.SymbolTexturePool.InitSymbolTexture(a);null===this._SymbolPointVertexBuffer&&(this._SymbolPointVertexBuffer=a.CreateVertexBuffer(ENUM_GL.STREAM_DRAW,ENUM_FVF.XYZW,new Float32Array([0,0,0,1])));this.SymbolPointShader.UseProgram();
this.SymbolPointShader.DisableAllVertexAttrib();a.BindVertexBuffer(this._SymbolPointVertexBuffer);this.SymbolPointShader.VertexAttribPointer(this.SymbolPointShader.AttribLocations.Input_p,3,ENUM_GL.FLOAT,!1,0,0);var d=new Matrix4;d.set(a.ProjectionMatrix).multiply(a.ViewMatrix);this.SymbolPointShader.Uniforms.matViewProj.setValue(d.elements)};b.prototype.DrawSymbolPoint=function(a,d,e){if(this.Show){this._InitDrawSymbolPoint(a);for(var c=0;c<this._Entities.length;c++)this._Entities[c].IsShow()&&this._Entities[c].DrawSymbolPoint(a,
d,e)}};var f=function(a){SUPERCLASS_CONSTRUCT(DEVICE.CShaderProgram,this,a);this.Name="FieldStrengthShader";this.VertShaderSrc=GLSL_SOURCE.fieldStrength_vert;this.FragShaderSrc=GLSL_SOURCE.fieldStrength_frag};DEFINE_INHERITANCE(f,DEVICE.CShaderProgram);var g=function(a){SUPERCLASS_CONSTRUCT(DEVICE.CShaderProgram,this,a);this.Name="SymbolPoint";this.VertShaderSrc=GLSL_SOURCE.symbolPoint_vert;this.FragShaderSrc=GLSL_SOURCE.symbolPoint_frag};DEFINE_INHERITANCE(g,DEVICE.CShaderProgram);var h=function(a){SUPERCLASS_CONSTRUCT(DEVICE.CShaderProgram,
this,a);this.Name="RadarAnimeShader";this.VertShaderSrc=GLSL_SOURCE.radarAnime_vert;this.FragShaderSrc=GLSL_SOURCE.radarAnime_frag};DEFINE_INHERITANCE(h,DEVICE.CShaderProgram);var k=function(a){SUPERCLASS_CONSTRUCT(DEVICE.CShaderProgram,this,a);this.Name="Radar2DSurfaceShader";this.VertShaderSrc=GLSL_SOURCE.radar2DSurfaceShader_vert;this.FragShaderSrc=GLSL_SOURCE.radar2DSurfaceShader_frag};DEFINE_INHERITANCE(k,DEVICE.CShaderProgram);this.CMilitaryBackEndCustomLayer=b}).call(this);

(function(){this.CMilitaryEntity=function(a,b,c){this._Scenes=a;this._TerrainEngine=b;this._TerrainSurfaceCustomLayer=this._Scenes.GetTerrainSurfaceCustomLayer();this._ShadowVolumeSurfaceCustomLayer=this._Scenes.GetShadowVolumeSurfaceCustomLayer();this._SymbolCustomLayer=this._Scenes.GetSymbolCustomLayer();this._CommonCustomLayer=this._Scenes.GetCommonCustomLayer()}}).call(this);

(function(){var c=function(a,b,d){SUPERCLASS_CONSTRUCT(CMilitaryEntity,this,a,b,d);this._CustomSymbol=null;this.UpdateParameter(d)};DEFINE_INHERITANCE(c,CMilitaryEntity);c.prototype._GetSymbolUrlFromCode=function(a,b){b=Default(b,64,IsNumber);return this._TerrainEngine.TerrainLayer.GetUrlManager().GetUrl(this._TerrainEngine.TerrainLayer.GetServerUrl()+"/military?request=milsymbol&code="+a+"&size="+b)};c.prototype.UpdateParameter=function(a){a.code&&(a.symbol=this._GetSymbolUrlFromCode(a.code,64));
null===this._CustomSymbol?this._CustomSymbol=this._SymbolCustomLayer.AddSymbolPointEntity(a):this._CustomSymbol.UpdateParameter(a)};c.prototype.Release=function(){null!==this._CustomSymbol&&this._SymbolCustomLayer.RemoveEntity(this._CustomSymbol)};this.CMilitary2525BEntity=c}).call(this);

(function(){var b=function(a,c,d){SUPERCLASS_CONSTRUCT(CMilitaryEntity,this,a,c,d);this._Radar2DAnalysis=this._CreateRadar2DAnalysis();this._CustomFieldSurface=null;this._Center=new Geo3DPoint;this._Radius=null;this._PlaneCenter=0;this._ExtendAngle=360;this._EffectiveRadiatedPower=this._Frequency=null;this._Opacity=1;this._ColorTable=this._StrengthTable=this._Gains=null;this._UseViewShed=!0;this._AnalysisResultMaskBoundary=this._AnalysisResultMaskWidth=this._AnalysisResultMaskHeight=this._AnalysisResultMaskBitmap=
null;this.UpdateParameter(d)};DEFINE_INHERITANCE(b,CMilitaryEntity);b.prototype.UpdateParameter=function(a){var c=a.analysis;this._Frequency=Default(a.frequency,this._Frequency,IsNumber);this._EffectiveRadiatedPower=Default(a.effectiveRadiatedPower,this._Frequency,IsNumber);this._Opacity=Default(a.opacity,this._Opacity,IsNumber);this._Gains=Default(a.gains,this._Gains);this._StrengthTable=Default(a.strengthTable,this._StrengthTable);this._ColorTable=Default(a.colorTable,this._ColorTable);this._UseViewShed=
Default(a.useViewShed,this._UseViewShed);this.InitParameter(c)};b.prototype.InitParameter=function(a){a&&(this._Radar2DAnalysis.GetResult(a,this._UpdateAnalysisResult.bind(this)),this._Center=Default(a.geo,this._Center),this._Radius=Default(a.radius,this._Radius,IsNumber),this._PlaneCenter=Default(a.planeCenter,this._PlaneCenter,IsNumber),this._ExtendAngle=Default(a.extendAngle,this._ExtendAngle,IsNumber));this._UpdateCustomFieldSurface({geo:this._Center,radius:this._Radius,planeCenter:this._PlaneCenter,
extendAngle:this._ExtendAngle,frequency:this._Frequency,effectiveRadiatedPower:this._EffectiveRadiatedPower,opacity:this._Opacity,gains:this._Gains,strengthTable:this._StrengthTable,colorTable:this._ColorTable,useViewShed:this._UseViewShed})};b.prototype._UpdateAnalysisResult=function(a){this._AnalysisResultMaskBitmap=a.GetMaskBitmap();this._AnalysisResultMaskHeight=a.GetMaskHeight();this._AnalysisResultMaskWidth=a.GetMaskWidth();this._AnalysisResultMaskBoundary=a.GetMaskBoundary();this._InitCustomFieldSurface()};
b.prototype._UpdateCustomFieldSurface=function(a){null!==this._CustomFieldSurface?this._CustomFieldSurface.UpdateParameter(a):this._InitCustomFieldSurface()};b.prototype._InitCustomFieldSurface=function(){this.Release();this._CustomFieldSurface=this._TerrainSurfaceCustomLayer.AddFieldStrengthEntity({geo:this._Center,radius:this._Radius,planeCenter:this._PlaneCenter,extendAngle:this._ExtendAngle,frequency:this._Frequency,effectiveRadiatedPower:this._EffectiveRadiatedPower,opacity:this._Opacity,gains:this._Gains,
strengthTable:this._StrengthTable,colorTable:this._ColorTable,useViewShed:this._UseViewShed,maskBitmap:this._AnalysisResultMaskBitmap,maskWidth:this._AnalysisResultMaskWidth,maskHeight:this._AnalysisResultMaskHeight,maskBoundary:this._AnalysisResultMaskBoundary})};b.prototype._CreateRadar2DAnalysis=function(){var a=this._TerrainEngine.TerrainLayer.LayerName,c=this._TerrainEngine.TerrainLayer.GetUrlManager().GetUrl(this._TerrainEngine.TerrainLayer.GetServerUrl());return new CRadar2DAnalysis(a,c)};
b.prototype.Release=function(){null!==this._CustomFieldSurface&&this._TerrainSurfaceCustomLayer.RemoveEntity(this._CustomFieldSurface)};this.CMilitaryFieldStrengthEntity=b}).call(this);

(function(){var b=function(a,c,d){SUPERCLASS_CONSTRUCT(CMilitaryEntity,this,a,c,d);this._FlightPathAnalysis=this._CreateFlightPathAnalysis();this._FlightPathPolyline=null;this._Color="#0000FF";this._Opacity=1;this._Size=3;this._CustomPolyline3D=null;this.UpdateParameter(d)};DEFINE_INHERITANCE(b,CMilitaryEntity);b.prototype.UpdateParameter=function(a){var c=a.analysis,d=Default(a.color,void 0,IsString),e=Default(a.size,void 0,IsNumber);a=Default(a.opacity,void 0,IsNumber);this._Color=Default(d,this._Color);
this._Opacity=Default(a,this._Opacity);this._Size=Default(e,this._Size);this.InitParameter(c,d,e,a)};b.prototype.InitParameter=function(a,c,d,e){a&&this._FlightPathAnalysis.GetResult(a,this._UpdateAnalysisResult.bind(this));this._UpdateCustomPolyline3D({color:Default(c,void 0,IsString),size:Default(d,void 0,IsNumber),opacity:Default(e,void 0,IsNumber)})};b.prototype._UpdateAnalysisResult=function(a){this._FlightPathPolyline=a.GetFlightPathPolyline();this._InitCustomPolyline3D()};b.prototype._CreateFlightPathAnalysis=
function(){var a=this._TerrainEngine.TerrainLayer.LayerName,c=this._TerrainEngine.TerrainLayer.GetUrlManager().GetUrl(this._TerrainEngine.TerrainLayer.GetServerUrl());return new CFlightPathAnalysis(a,c)};b.prototype._InitCustomPolyline3D=function(){this.Release();null!==this._FlightPathPolyline&&(this._CustomPolyline3D=this._CommonCustomLayer.AddPolylineEntity({geo:this._FlightPathPolyline,color:this._Color,size:this._Size,opacity:this._Opacity}))};b.prototype._UpdateCustomPolyline3D=function(a){null!==
this._CustomPolyline3D&&this._CustomPolyline3D.UpdateParameter(a)};b.prototype.Release=function(){null!==this._CustomPolyline3D&&(this._CommonCustomLayer.RemoveEntity(this._CustomPolyline3D),this._CustomPolyline3D=null)};this.CMilitaryFlightPathEntity=b}).call(this);

(function(){var b=function(a,c,d){SUPERCLASS_CONSTRUCT(CMilitaryEntity,this,a,c,d);this._Radar2DAnalysis=this._CreateRadar2DAnalysis();this._ViewColor="#00FF00";this._UnviewColor="#FF0000";this._UnviewOpacity=this._ViewOpacity=.5;this._AnalysisResultMaskBitmap=null;this._AnalysisResultMaskWidth=this._AnalysisResultMaskHeight=0;this._CustomRadar2DSurface=this._AnalysisResultMaskBoundary=null;this.UpdateParameter(d)};DEFINE_INHERITANCE(b,CMilitaryEntity);b.prototype.UpdateParameter=function(a){var c=
a.analysis,d=Default(a.viewColor,void 0,IsString),e=Default(a.unviewColor,void 0,IsString),f=Default(a.viewOpacity,void 0,IsNumber);a=Default(a.unviewOpacity,void 0,IsNumber);this._ViewColor=Default(d,this._ViewColor);this._UnviewColor=Default(e,this._UnviewColor);this._ViewOpacity=Default(f,this._ViewOpacity);this._UnviewOpacity=Default(a,this._UnviewOpacity);this.InitParameter(c,d,e,f,a)};b.prototype.InitParameter=function(a,c,d,e,f){a&&this._Radar2DAnalysis.GetResult(a,this._UpdateAnalysisResult.bind(this));
this._UpdateCustomRadar2DSurface({viewColor:Default(c,void 0,IsString),viewOpacity:Default(e,void 0,IsNumber),unviewColor:Default(d,void 0,IsString),unviewOpacity:Default(f,void 0,IsNumber)})};b.prototype._UpdateAnalysisResult=function(a){this._AnalysisResultMaskBitmap=a.GetMaskBitmap();this._AnalysisResultMaskHeight=a.GetMaskHeight();this._AnalysisResultMaskWidth=a.GetMaskWidth();this._AnalysisResultMaskBoundary=a.GetMaskBoundary();this._InitCustomRadar2DSurface()};b.prototype._InitCustomRadar2DSurface=
function(){this.Release();null!==this._AnalysisResultMaskBitmap&&(this._CustomRadar2DSurface=this._TerrainSurfaceCustomLayer.AddRadar2DSurface({maskBitmap:this._AnalysisResultMaskBitmap,maskWidth:this._AnalysisResultMaskWidth,maskHeight:this._AnalysisResultMaskHeight,maskBoundary:this._AnalysisResultMaskBoundary,viewColor:this._ViewColor,unviewColor:this._UnviewColor,viewOpacity:this._ViewOpacity,unviewOpacity:this._UnviewOpacity}))};b.prototype._UpdateCustomRadar2DSurface=function(a){null!==this._CustomRadar2DSurface&&
this._CustomRadar2DSurface.UpdateParameter(a)};b.prototype._CreateRadar2DAnalysis=function(){var a=this._TerrainEngine.TerrainLayer.LayerName,c=this._TerrainEngine.TerrainLayer.GetUrlManager().GetUrl(this._TerrainEngine.TerrainLayer.GetServerUrl());return new CRadar2DAnalysis(a,c)};b.prototype.Release=function(){null!==this._CustomRadar2DSurface&&(this._TerrainSurfaceCustomLayer.RemoveEntity(this._CustomRadar2DSurface),this._CustomRadar2DSurface=null)};this.CMilitaryRadar2DEntity=b}).call(this);

(function(){var b=function(a,c,d){SUPERCLASS_CONSTRUCT(CMilitaryEntity,this,a,c,d);this._Radar3DAnalysis=this._CreateRadar3DAnalysis();this._TrianglesPoint=null;this._DrawColor="#00FFFF";this._DrawOpacity=1;this._FillColor="#00FFFF";this._FillOpacity=.2;this._CustomTriangleSet=null;this.UpdateParameter(d)};DEFINE_INHERITANCE(b,CMilitaryEntity);b.prototype.UpdateParameter=function(a){var c=a.analysis,d=Default(a.drawColor,void 0,IsString),e=Default(a.drawOpacity,void 0,IsNumber),f=Default(a.fillColor,
void 0,IsString);a=Default(a.fillOpacity,void 0,IsNumber);this._DrawColor=Default(d,this._DrawColor);this._DrawOpacity=Default(e,this._DrawOpacity);this._FillColor=Default(f,this._FillColor);this._FillOpacity=Default(a,this._FillOpacity);this.InitParameter(c,d,e,f,a)};b.prototype.InitParameter=function(a,c,d,e,f){a&&this._Radar3DAnalysis.GetResult(a,this._UpdateAnalysisResult.bind(this));this._UpdateCustomTriangleSet({drawColor:Default(c,void 0,IsString),drawOpacity:Default(d,void 0,IsNumber),fillColor:Default(e,
void 0,IsString),fillOpacity:Default(f,void 0,IsNumber)})};b.prototype._UpdateAnalysisResult=function(a){this._TrianglesPoint=a.GetTrianglesPoint();this._InitCustomTriangleSet()};b.prototype._CreateRadar3DAnalysis=function(){var a=this._TerrainEngine.TerrainLayer.LayerName,c=this._TerrainEngine.TerrainLayer.GetUrlManager().GetUrl(this._TerrainEngine.TerrainLayer.GetServerUrl());return new CRadar3DAnalysis(a,c)};b.prototype._InitCustomTriangleSet=function(){this.Release();null!==this._TrianglesPoint&&
(this._CustomTriangleSet=this._CommonCustomLayer.AddTransparentTriangleSetEntity({geo:this._TrianglesPoint,drawColor:this._DrawColor,drawOpacity:this._DrawOpacity,fillColor:this._FillColor,fillOpacity:this._FillOpacity,drawLines:!0}))};b.prototype._UpdateCustomTriangleSet=function(a){null!==this._CustomTriangleSet&&this._CustomTriangleSet.UpdateParameter(a)};b.prototype.Release=function(){null!==this._CustomTriangleSet&&(this._CommonCustomLayer.RemoveEntity(this._CustomTriangleSet),this._CustomTriangleSet=
null)};this.CMilitaryRadar3DEntity=b}).call(this);

(function(){var b=function(a,d,c){SUPERCLASS_CONSTRUCT(CMilitaryEntity,this,a,d,c);this._CustomRadarAnime=null;this.UpdateParameter(c)};DEFINE_INHERITANCE(b,CMilitaryEntity);b.prototype.UpdateParameter=function(a){null===this._CustomRadarAnime?this._CustomRadarAnime=this._CommonCustomLayer.AddRadarAnimeEntity(a):this._CustomRadarAnime.UpdateParameter(a)};b.prototype.Release=function(){null!==this._CustomRadarAnime&&this._CommonCustomLayer.RemoveEntity(this._CustomRadarAnime)};this.CMilitaryRadarAnimeEntity=
b}).call(this);

(function(){var c=function(a,b,e){SUPERCLASS_CONSTRUCT(CMilitaryEntity,this,a,b,e);this._SatelliteName="";this._OrbitalColor="#E80000";this._OrbitDetail=90;this._OrbitalEntity=this._FallLineEntity=this._ViewConeEntity=this._SatellitePointEntity=null;this._IsDrawFallLine=this._IsDrawViewCone=this._IsDrawOrbit=this._IsDrawSatellite=!0;this._SatelliteFOV=45;this._Opacity=1;this._SatellitePointSize=30;this._SatelliteInfoSize=12;this._SatelliteRecord=null;this._SatelliteOrbitalRecords=[];this._SatellitePosition=
null;this._SatelliteOrbitalPosition=[];this._IconSource=null;this._PlaySpeed=1;this._CurrentSystemTime=new Date;this._lastShowTime=null;this._CurrentShowTime=new Date(this._CurrentSystemTime);this.UpdateParameter(e)};DEFINE_INHERITANCE(c,CMilitaryEntity);c.prototype.UpdateParameter=function(a){var b=Default(a.tleTitle,void 0,IsString),e=Default(a.tleLine1,void 0,IsString),k=Default(a.tleLine2,void 0,IsString),n=Default(a.satelliteFOV,void 0,IsNumber),f=Default(a.icon,void 0,IsString),d=Default(a.iconSize,
void 0,IsNumber),l=Default(a.satelliteColor,void 0,IsString),g=Default(a.orbitDetail,void 0,IsNumber),h=Default(a.showSatellite,void 0,IsBool),m=Default(a.showOrbit,void 0,IsBool),q=Default(a.showViewCone,void 0,IsBool),p=Default(a.showGroundLine,void 0,IsBool),r=Default(a.playSpeed,void 0,IsNumber);this._SatelliteName=Default(b,this._SatelliteName);this._SatelliteTLELine1=Default(e,this._SatelliteTLELine1);this._SatelliteTLELine2=Default(k,this._SatelliteTLELine2);this._SatelliteFOV=Default(n,this._SatelliteFOV);
this._IconSource=Default(f,this._IconSource);this._SatellitePointSize=Default(d,this._SatellitePointSize);this._OrbitalColor=Default(l,this._OrbitalColor);this._OrbitDetail=Default(g,this._OrbitDetail);this._IsDrawSatellite=Default(h,this._IsDrawSatellite);this._IsDrawOrbit=Default(m,this._IsDrawOrbit);this._IsDrawViewCone=Default(q,this._IsDrawViewCone);this._IsDrawFallLine=Default(p,this._IsDrawFallLine);this._PlaySpeed=Default(r,this._PlaySpeed);a.playTime&&(this._CurrentShowTime=new Date(a.playTime));
this.InitParameter(b,e,k,n,f,d,l,g,h,m,q,p)};c.prototype.InitParameter=function(a,b,e,k,n,f,d,l,g,h,m,q){var p={},r={},u={},t={};b&&e&&(this._SatelliteRecord=c.MakeSatelliteRecord(this._SatelliteTLELine1,this._SatelliteTLELine2),this._SatelliteRecord.COSPARID=b.substring(9,11)+"-"+b.substring(11,17).trim(),this._SatelliteRecord.meanMotion=parseFloat(e.substring(52,63)),b=Math.pow(8681663.653/this._SatelliteRecord.meanMotion,2/3),e=this._TerrainEngine.MoveFun_GetRadius(),this._SatelliteRecord.perigee=
b*(1-this._SatelliteRecord.ecco)*1E3-e,this._SatelliteRecord.apogee=b*(1+this._SatelliteRecord.ecco)*1E3-e,this._SatelliteOrbitalRecords=c.MakeSatelliteOrbitalRecords(this._SatelliteTLELine1,this._SatelliteTLELine2,this._OrbitDetail),this.ReleaseSatellitePointEntity(),this.ReleaseViewConeEntity(),this.ReleaseFallPolylineEntity(),this.ReleaseOrbitalPolylineEntity());a&&(p.label={},p.label.text=this._SatelliteName);n&&(p.symbol=this._IconSource);f&&(p.size=this._SatellitePointSize);d&&(r.color=this._OrbitalColor,
u.color=this._OrbitalColor,t.color=this._OrbitalColor);l&&(this._SatelliteOrbitalRecords=c.MakeSatelliteOrbitalRecords(this._SatelliteTLELine1,this._SatelliteTLELine2,this._OrbitDetail));void 0!==g&&!1===this._IsDrawSatellite&&(this.ReleaseSatellitePointEntity(),this._lastShowTime=null);if(l||void 0!==h&&!1===this._IsDrawOrbit)this.ReleaseOrbitalPolylineEntity(),this._lastShowTime=null;void 0!==m&&!1===this._IsDrawViewCone&&this.ReleaseViewConeEntity();void 0!==q&&!1===this._IsDrawFallLine&&this.ReleaseFallPolylineEntity();
this.RequestUpdate();k&&(a=this._TerrainEngine.GetSurfaceRadiusByMap(this._SatellitePosition)+this._SatellitePosition.z,a=Math.min(a,a-40680631590769/a),t.radius=a*Math.tan(Math.min(this._SatelliteFOV*GeoUtility.PI_DIV_180*.5,6378137/Math.sqrt(40680631590769+a*a))));this._UpdateSatellitePointEntity(p);this._UpdateViewConeEntity(r);this._UpdateFallPolylineEntity(u);this._UpdateOrbitalPolylineEntity(t)};c.prototype._InitSatellitePointEntity=function(){if(null!==this._SatellitePosition&&this._IsDrawSatellite){var a=
{geo:this._SatellitePosition,size:this._SatellitePointSize,labelOffset:new GeoPoint(0,0,this._SatellitePointSize+this._SatelliteInfoSize),label:{size:this._SatelliteInfoSize,borderSize:5,text:this._SatelliteName},symbol:this._IconSource};this._SatellitePointEntity=this._CommonCustomLayer.AddPointEntity(a)}};c.prototype._InitViewConeEntity=function(){if(null!==this._SatellitePosition&&this._IsDrawViewCone){var a=this._TerrainEngine.GetSurfaceRadiusByMap(this._SatellitePosition)+this._SatellitePosition.z;
a=Math.min(a,a-40680631590769/a);this._ViewConeEntity=this._CommonCustomLayer.AddConeEntity({geo:this._SatellitePosition,distance:a,radius:a*Math.tan(Math.min(this._SatelliteFOV*GeoUtility.PI_DIV_180*.5,6378137/Math.sqrt(40680631590769+a*a))),color:this._OrbitalColor,opacity:.4*this._Opacity})}};c.prototype._InitFallPolylineEntity=function(){if(null!==this._SatellitePosition&&this._IsDrawFallLine){var a=new GeoPolyline;a.Buffer.push(this._SatellitePosition);a.Buffer.push(new GeoPoint(this._SatellitePosition.x,
this._SatellitePosition.y,0));this._FallLineEntity=this._CommonCustomLayer.AddPolylineEntity({geo:a,size:1,color:this._OrbitalColor})}};c.prototype._InitOrbitalPolylineEntity=function(){if(2<=this._SatelliteOrbitalPosition.length&&this._IsDrawOrbit){var a={geo:new GeoPolyline(this._SatelliteOrbitalPosition),size:1.5,opacity:this._Opacity,color:this._OrbitalColor};this._OrbitalEntity=this._CommonCustomLayer.AddPolylineEntity(a)}};c.prototype._UpdateSatellitePointEntity=function(a){this._IsDrawSatellite&&
(null!==this._SatellitePointEntity?this._SatellitePointEntity.UpdateParameter(a):this._InitSatellitePointEntity())};c.prototype._UpdateViewConeEntity=function(a){this._IsDrawViewCone&&(null!==this._ViewConeEntity?this._ViewConeEntity.UpdateParameter(a):this._InitViewConeEntity())};c.prototype._UpdateFallPolylineEntity=function(a){this._IsDrawFallLine&&(null!==this._FallLineEntity?this._FallLineEntity.UpdateParameter(a):this._InitFallPolylineEntity())};c.prototype._UpdateOrbitalPolylineEntity=function(a){this._IsDrawOrbit&&
(null!==this._OrbitalEntity?this._OrbitalEntity.UpdateParameter(a):this._InitOrbitalPolylineEntity())};c.prototype.Release=function(){this.ReleaseSatellitePointEntity();this.ReleaseViewConeEntity();this.ReleaseFallPolylineEntity();this.ReleaseOrbitalPolylineEntity();this._IsDrawFallLine=this._IsDrawViewCone=this._IsDrawOrbit=this._IsDrawSatellite=!1};c.prototype.ReleaseSatellitePointEntity=function(){null!==this._SatellitePointEntity&&(this._CommonCustomLayer.RemoveEntity(this._SatellitePointEntity),
this._SatellitePointEntity=null)};c.prototype.ReleaseViewConeEntity=function(){null!==this._ViewConeEntity&&(this._CommonCustomLayer.RemoveEntity(this._ViewConeEntity),this._ViewConeEntity=null)};c.prototype.ReleaseFallPolylineEntity=function(){null!==this._FallLineEntity&&(this._CommonCustomLayer.RemoveEntity(this._FallLineEntity),this._FallLineEntity=null)};c.prototype.ReleaseOrbitalPolylineEntity=function(){null!==this._OrbitalEntity&&(this._CommonCustomLayer.RemoveEntity(this._OrbitalEntity),
this._OrbitalEntity=null)};c.prototype._IsNeedUpdate=function(){var a=this._CurrentSystemTime.getTime();this._CurrentSystemTime=new Date;a=(this._CurrentSystemTime.getTime()-a)*this._PlaySpeed;this._CurrentShowTime.setTime(this._CurrentShowTime.getTime()+a);a=this._lastShowTime!==this._CurrentShowTime.getTime();this._lastShowTime=this._CurrentShowTime.getTime();return a};c.prototype.RequestUpdate=function(){if(this._IsNeedUpdate()){if(null!==this._SatelliteRecord&&(this._IsDrawSatellite||this._IsDrawFallLine||
this._IsDrawViewCone)){var a=c.CalcSatellitePosition(this._SatelliteRecord,this._CurrentShowTime);this._SatellitePosition=new GeoPoint(a[0],a[1],1E3*a[2])}if(0<this._SatelliteOrbitalRecords.length&&this._IsDrawOrbit)for(a=this._SatelliteOrbitalPosition.length=0;a<this._SatelliteOrbitalRecords.length;a++){var b=c.CalcSatellitePosition(this._SatelliteOrbitalRecords[a],this._CurrentShowTime);this._SatelliteOrbitalPosition.push(new GeoPoint(b[0],b[1],1E3*b[2]))}this._UpdatePosition()}};c.prototype.GetHoveTimeSpan=
function(a){var b=new Date(a.begin),e=new Date(a.end),k=Default(a.fov,15,IsNumber);k*=DEGTORAD;var n=Default(a.gap,1,IsNumber);n*=6E4;var f=Default(a.epsg,4326,IsNumber),d=a.target;a=[];var l=[],g={success:!1};if(b.getTime()>=e.getTime())g.message="Invalid begin and end";else if(IsObject(d,["x","y","z"])){d=new Geo3DPoint(d.x,d.y,d.z);4326!==f&&GetEPSGEngine().Transfer(4326,f,d);this._TerrainEngine.MapToWorldMap(d);this._TerrainEngine.WorldMapToWorldXYZ(d);for(b=b.getTime();b<e.getTime();b+=n){f=
this.GetSatellitePosition(new Date(b));var h=new Geo3DPoint(f.x,f.y,f.z);this._TerrainEngine.MapToWorldMap(h);this._TerrainEngine.WorldMapToWorldXYZ(h);var m=h.Sub(d);Math.acos(m.DotProduct(h)/m.Length/h.Length)<=k&&(m=Math.acos(h.DotProduct(d)/d.Length/h.Length),0<m&&m<Math.acos(this._TerrainEngine.Radius/h.Length)&&(a.push(new Date(b)),l.push(f)))}0<a.length&&(g.success=!0,g.date=a,g.positions=l)}else g.message="Invalid target";return g};c.prototype.GetSatellitePosition=function(a){a=c.CalcSatellitePosition(this._SatelliteRecord,
a);return new GeoPoint(a[0],a[1],1E3*a[2])};c.prototype._UpdatePosition=function(){this._UpdateSatellitePointEntity({geo:new GeoPoint(this._SatellitePosition)});var a=this._TerrainEngine.GetSurfaceRadiusByMap(this._SatellitePosition)+this._SatellitePosition.z;a=Math.min(a,a-40680631590769/a);var b=Math.min(this._SatelliteFOV*GeoUtility.PI_DIV_180*.5,6378137/Math.sqrt(40680631590769+a*a));this._UpdateViewConeEntity({geo:new GeoPoint(this._SatellitePosition),distance:a,radius:a*Math.tan(b)});this._UpdateFallPolylineEntity({geo:new GeoPolyline([new GeoPoint(this._SatellitePosition),
new GeoPoint(this._SatellitePosition.x,this._SatellitePosition.y,0)])});this._UpdateOrbitalPolylineEntity({geo:new GeoPolyline(this._SatelliteOrbitalPosition)});this._TerrainEngine.UpdateScreen()};c.MakeSatelliteRecord=function(a,b){return 69===a.length&&69===b.length?satellite.twoline2satrec(a,b):null};c.CalcSatellitePosition=function(a,b){a=satellite.propagate(a,b).position;b=satellite.gstime(b);var e=satellite.eciToGeodetic(a,b);a=e.latitude;b=e.height;e=satellite.degreesLong(e.longitude);a=satellite.degreesLat(a);
return[e,a,b]};c.MakeSatelliteOrbitalRecords=function(a,b,e){for(var k=[],n=360/e,f=0;f<e;f++){for(var d=(f*n).toString(),l=3-d.length,g=0;g<l;g++)d=" "+d;b=b.substring(0,43)+d+b.substring(46);d=c.MakeSatelliteRecord(a,b);null!==d&&k.push(d)}b=b.substring(0,43)+"  0"+b.substring(46);a=c.MakeSatelliteRecord(a,b);null!==a&&k.push(a);return k};this.CMilitarySatelliteEntity=c}).call(this);

(function(){var b=function(a){this._TerrainEngine=a;this._TerrainSurfaceCustomLayer=new CMilitaryBackEndCustomLayer(a,"");this._ShadowVolumeSurfaceCustomLayer=new CMilitaryBackEndCustomLayer(a,"");this._SymbolCustomLayer=new CMilitaryBackEndCustomLayer(a,"");this._CommonCustomLayer=new CMilitaryBackEndCustomLayer(a,"");this._Entities=[];this._StreamingEntities=[]};b.prototype.Draw=function(a,d,c){this._TerrainSurfaceCustomLayer.DrawTerrainSurfaceEffects(a,d,c);this._ShadowVolumeSurfaceCustomLayer.Draw(a,
d,c);this._SymbolCustomLayer.DrawSymbolPoint(a,d,c);this._CommonCustomLayer.Draw(a,d,c);this._RequestStreamingEntity()};b.prototype._RequestStreamingEntity=function(){for(var a=0;a<this._StreamingEntities.length;a++)this._StreamingEntities[a].RequestUpdate()};b.prototype.GetTerrainSurfaceCustomLayer=function(){return this._TerrainSurfaceCustomLayer};b.prototype.GetShadowVolumeSurfaceCustomLayer=function(){return this._ShadowVolumeSurfaceCustomLayer};b.prototype.GetSymbolCustomLayer=function(){return this._SymbolCustomLayer};
b.prototype.GetCommonCustomLayer=function(){return this._CommonCustomLayer};b.prototype.AddFlightPathEntity=function(a){a=new CMilitaryFlightPathEntity(this,this._TerrainEngine,a);this._Entities.push(a);return a};b.prototype.Add2525BEntity=function(a){a=new CMilitary2525BEntity(this,this._TerrainEngine,a);this._Entities.push(a);return a};b.prototype.AddRadar3DEntity=function(a){a=new CMilitaryRadar3DEntity(this,this._TerrainEngine,a);this._Entities.push(a);return a};b.prototype.AddRadar2DEntity=function(a){a=
new CMilitaryRadar2DEntity(this,this._TerrainEngine,a);this._Entities.push(a);return a};b.prototype.AddRadarAnimeEntity=function(a){a=new CMilitaryRadarAnimeEntity(this,this._TerrainEngine,a);this._Entities.push(a);return a};b.prototype.AddFieldStrengthEntity=function(a){a=new CMilitaryFieldStrengthEntity(this,this._TerrainEngine,a);this._Entities.push(a);return a};b.prototype.AddSatelliteEntity=function(a){a=new CMilitarySatelliteEntity(this,this._TerrainEngine,a);this._Entities.push(a);this._StreamingEntities.push(a);
return a};b.prototype.RemoveEntity=function(a){for(var d=!1,c=0;c<this._Entities.length;c++)this._Entities[c]===a&&(this._Entities[c].Release(),this._Entities.splice(c,1),d=!0);for(c=0;c<this._StreamingEntities.length;c++)this._StreamingEntities[c]===a&&(this._StreamingEntities[c].Release(),this._StreamingEntities.splice(c,1));this._TerrainEngine.UpdateScreen();return d};b.prototype.RemoveAllEntity=function(){for(var a=0;a<this._Entities.length;a++)this._Entities[a].Release();this._Entities.length=
0;this._StreamingEntities.length=0;this._TerrainEngine.UpdateScreen()};this.CMilitaryScenes=b}).call(this);

(function(){var b=function(c,a){SUPERCLASS_CONSTRUCT(CTerrainViewModule,this,c,a);this.Scenes=new CMilitaryScenes(a)};DEFINE_INHERITANCE(b,CTerrainViewModule);b.prototype.DrawOrder=5;b.prototype.Draw=function(c,a,d,e){this.Scenes.Draw(c,a,d)};CTerrainViewModule.RegisterModule("military",b)}).call(this);

var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in d))return;d=d[g]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&($jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(e):
$jscomp.POLYFILL_PREFIX+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};$jscomp.assign=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)$jscomp.owns(d,e)&&(a[e]=d[e])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");
(function(){ov.MilitaryModule=function(a){SUPERCLASS_CONSTRUCT(ov.Module,this,a)};DEFINE_INHERITANCE(ov.MilitaryModule,ov.Module);ov.MilitaryModule.prototype.add2525BEntity=function(a){return new ov.MilitaryEntity(this._module.Scenes.Add2525BEntity(a))};ov.MilitaryModule.prototype.addFlightPathEntity=function(a){a=Object.assign({},a);IsClass(a.color,ov.Color)&&(a.color=a.color.toHex("RGB"));return new ov.MilitaryEntity(this._module.Scenes.AddFlightPathEntity(a))};ov.MilitaryModule.prototype.addRadar3DEntity=
function(a){a=Object.assign({},a);IsClass(a.drawColor,ov.Color)&&(a.drawColor=a.drawColor.toHex("RGB"));IsClass(a.fillColor,ov.Color)&&(a.fillColor=a.fillColor.toHex("RGB"));return new ov.MilitaryEntity(this._module.Scenes.AddRadar3DEntity(a))};ov.MilitaryModule.prototype.addRadar2DEntity=function(a){a=Object.assign({},a);IsClass(a.viewColor,ov.Color)&&(a.viewColor=a.viewColor.toHex("RGB"));IsClass(a.unviewColor,ov.Color)&&(a.unviewColor=a.unviewColor.toHex("RGB"));return new ov.MilitaryEntity(this._module.Scenes.AddRadar2DEntity(a))};
ov.MilitaryModule.prototype.addRadarAnimeEntity=function(a){a=Object.assign({},a);IsClass(a.color,ov.Color)&&(a.color=a.color.toHex("RGB"));IsClass(a.scanColor,ov.Color)&&(a.scanColor=a.scanColor.toHex("RGB"));return new ov.MilitaryEntity(this._module.Scenes.AddRadarAnimeEntity(a))};ov.MilitaryModule.prototype.addFieldStrengthEntity=function(a){a=Object.assign({},a);if(IsArray(a.colorTable)){var b=a.colorTable;a.colorTable=[];for(var c=0;c<b.length;c++)a.colorTable[c]=IsClass(b[c],ov.Color)?b[c].toHex("RGB"):
b[c]}return new ov.MilitaryEntity(this._module.Scenes.AddFieldStrengthEntity(a))};ov.MilitaryModule.prototype.addSatelliteEntity=function(a){a=Object.assign({},a);IsClass(a.satelliteColor,ov.Color)&&(a.satelliteColor=a.satelliteColor.toHex("RGB"));return new ov.MilitarySatelliteEntity(this._module.Scenes.AddSatelliteEntity(a))};ov.MilitaryModule.prototype.removeEntity=function(a){if(IsObject(a))return this._module.Scenes.RemoveEntity(a._entity)};ov.MilitaryModule.prototype.removeAllEntity=function(){this._module.Scenes.RemoveAllEntity()};
ov.MilitaryEntity=function(a){this._entity=a};ov.MilitaryEntity.prototype.update=function(a){this._entity.UpdateParameter(a)};ov.MilitarySatelliteEntity=function(a){SUPERCLASS_CONSTRUCT(ov.MilitaryEntity,this,a)};DEFINE_INHERITANCE(ov.MilitarySatelliteEntity,ov.MilitaryEntity);ov.MilitarySatelliteEntity.prototype.getPosition=function(a){return this._entity.GetSatellitePosition(a)};ov.MilitarySatelliteEntity.prototype.GetHoveTimeSpan=function(a){return this._entity.GetHoveTimeSpan(a)};ov.MilitarySatelliteEntity.prototype.GetTLEDate=
function(a){return this._entity._SatelliteRecord?satellite.invjday(this._entity._SatelliteRecord.jdsatepoch):null};ov.MilitarySatelliteEntity.prototype.GetInclination=function(a){return this._entity._SatelliteRecord?this._entity._SatelliteRecord.inclo*RADTODEG:null};ov.MilitarySatelliteEntity.prototype.GetIngOfAscendingNode=function(a){return this._entity._SatelliteRecord?this._entity._SatelliteRecord.nodeo*RADTODEG:null};ov.MilitarySatelliteEntity.prototype.GetArgumentOfPerigee=function(a){return this._entity._SatelliteRecord?
this._entity._SatelliteRecord.argpo*RADTODEG:null};ov.MilitarySatelliteEntity.prototype.GetFirstDerivative=function(a){return this._entity._SatelliteRecord?this._entity._SatelliteRecord.ndot:null};ov.MilitarySatelliteEntity.prototype.GetSecondDerivative=function(a){return this._entity._SatelliteRecord?this._entity._SatelliteRecord.nddot:null};ov.MilitarySatelliteEntity.prototype.GetEccentricity=function(a){return this._entity._SatelliteRecord?this._entity._SatelliteRecord.ecco:null};ov.MilitarySatelliteEntity.prototype.GetMeanAnomaly=
function(a){return this._entity._SatelliteRecord?this._entity._SatelliteRecord.mo*RADTODEG:null};ov.MilitarySatelliteEntity.prototype.GetMeanMotion=function(a){return this._entity._SatelliteRecord?this._entity._SatelliteRecord.meanMotion:null};ov.MilitarySatelliteEntity.prototype.GetPerigee=function(){return this._entity._SatelliteRecord?this._entity._SatelliteRecord.perigee:null};ov.MilitarySatelliteEntity.prototype.GetApogee=function(){return this._entity._SatelliteRecord?this._entity._SatelliteRecord.apogee:
null};ov.MilitarySatelliteEntity.prototype.GetCOSPARID=function(){return this._entity._SatelliteRecord?this._entity._SatelliteRecord.COSPARID:null};ov.MilitarySatelliteEntity.prototype.GetSatelliteCatalogNumber=function(){return this._entity._SatelliteRecord?this._entity._SatelliteRecord.satnum.trim():null};ov.Widget=ov.Widget||{};ov.Widget.SatelliteWidget=function(a){this._Callback=this._UIContainer=this._TerrainView=null;this.updateParameter(a);this._createUI();this._initEvent();this._InitInput();
this._TerrainView&&this._TerrainView.addWidget(this._UIContainer)};ov.Widget.SatelliteWidget.prototype.remove=function(){this._UIContainer.remove()};ov.Widget.SatelliteWidget.prototype.updateParameter=function(a){a&&(this._TerrainView=a.view,this._Callback=a.callback)};ov.Widget.SatelliteWidget.prototype._createUI=function(){this._UIContainer=document.createElement("div");this._UIContainer.classList.add("ov-widget-satelliteContainer");var a=document.createElement("div");this._UIContainer.append(a);
this._UIHeader=document.createElement("div");this._UIHeader.classList.add("ov-widget-satelliteHeader");this._UIHeader.style.width="100%";this._UIHeader.style.cursor="move";this._UIHeader.innerHTML="\u885b\u661f\u7ba1\u7406";this._UIContainer.append(this._UIHeader);this._SelectSatellite=document.createElement("select");this._SelectSatellite.classList.add("ov-widget-satelliteSelect");this._SelectSatellite.style.margin="5px";this._UIContainer.append(this._SelectSatellite);this._UIContent=document.createElement("div");
this._UIContent.style.width="100%";this._UIContainer.append(this._UIContent);this._NameInput=document.createElement("INPUT");this._NameInput.setAttribute("type","text");this._NameInput.classList.add("ov-widget-satelliteInput");this.InsertContent("\u540d\u7a31",this._NameInput);this._TLE1Input=document.createElement("INPUT");this._TLE1Input.setAttribute("type","text");this._TLE1Input.classList.add("ov-widget-satelliteInput");this.InsertContent("TLE1",this._TLE1Input);this._TLE2Input=document.createElement("INPUT");
this._TLE2Input.setAttribute("type","text");this._TLE2Input.classList.add("ov-widget-satelliteInput");this.InsertContent("TLE2",this._TLE2Input);this._FovInput=document.createElement("INPUT");this._FovInput.setAttribute("type","number");this._FovInput.classList.add("ov-widget-satelliteInput");this.InsertContent("\u885b\u661f\u8996\u91ce\u89d2\u5ea6",this._FovInput);this._IconInput=document.createElement("INPUT");this._IconInput.setAttribute("type","text");this._IconInput.classList.add("ov-widget-satelliteInput");
this.InsertContent("\u5716\u7247",this._IconInput);this._IconSizeInput=document.createElement("INPUT");this._IconSizeInput.setAttribute("type","number");this._IconSizeInput.classList.add("ov-widget-satelliteInput");this.InsertContent("\u5716\u7247\u5927\u5c0f",this._IconSizeInput);this._ColorInput=document.createElement("INPUT");this._ColorInput.setAttribute("type","color");this.InsertContent("\u984f\u8272",this._ColorInput);this._OrbitDetailInput=document.createElement("INPUT");this._OrbitDetailInput.setAttribute("type",
"number");this._OrbitDetailInput.classList.add("ov-widget-satelliteInput");this.InsertContent("\u8ecc\u9053\u5713\u7684\u908a\u6578",this._OrbitDetailInput);this._ShowSatelliteInput=document.createElement("INPUT");this._ShowSatelliteInput.setAttribute("type","checkbox");this.InsertContent("\u662f\u5426\u986f\u793a\u885b\u661f",this._ShowSatelliteInput);this._ShowOrbitInput=document.createElement("INPUT");this._ShowOrbitInput.setAttribute("type","checkbox");this.InsertContent("\u662f\u5426\u986f\u793a\u8ecc\u9053",
this._ShowOrbitInput);this._ShowViewConeInput=document.createElement("INPUT");this._ShowViewConeInput.setAttribute("type","checkbox");this.InsertContent("\u662f\u5426\u986f\u793a\u8996\u89d2\u9310",this._ShowViewConeInput);this._ShowGroundLineInput=document.createElement("INPUT");this._ShowGroundLineInput.setAttribute("type","checkbox");this.InsertContent("\u662f\u5426\u986f\u793a\u843d\u5730\u7dda",this._ShowGroundLineInput);this._PlaySpeedInput=document.createElement("INPUT");this._PlaySpeedInput.setAttribute("type",
"number");this._PlaySpeedInput.classList.add("ov-widget-satelliteInput");this.InsertContent("\u64ad\u653e\u901f\u5ea6",this._PlaySpeedInput);this._UIFooter=document.createElement("div");this._UIFooter.classList.add("ov-widget-satelliteFooter");this._UIContainer.append(this._UIFooter);this._CancelBtn=document.createElement("div");this._CancelBtn.classList.add("ov-widget-satelliteBtn");this._CancelBtn.innerText="\u96e2\u958b";this._UIFooter.append(this._CancelBtn);this._OkBtn=document.createElement("div");
this._OkBtn.innerText="\u78ba\u5b9a";this._OkBtn.classList.add("ov-widget-satelliteBtn");this._UIFooter.append(this._OkBtn);this._DeleteBtn=document.createElement("div");this._DeleteBtn.innerText="\u522a\u9664";this._DeleteBtn.style.float="left";this._DeleteBtn.classList.add("ov-widget-satelliteBtn");this._UIFooter.append(this._DeleteBtn)};ov.Widget.SatelliteWidget.prototype._InitInput=function(a){if(a){if(a=this._TerrainView.getModule("military")._module.Scenes._StreamingEntities[a-1])this._NameInput.value=
a._SatelliteName,this._TLE1Input.value=a._SatelliteTLELine1,this._TLE2Input.value=a._SatelliteTLELine2,this._FovInput.value=a._SatelliteFOV,this._IconInput.value=a._IconSource,this._IconSizeInput.value=a._SatellitePointSize,this._ColorInput.value=a._OrbitalColor,this._OrbitDetailInput.value=a._OrbitDetail,this._ShowSatelliteInput.checked=a._IsDrawSatellite,this._ShowOrbitInput.checked=a._IsDrawOrbit,this._ShowViewConeInput.checked=a._IsDrawViewCone,this._ShowGroundLineInput.checked=a._IsDrawFallLine,
this._PlaySpeedInput.value=a._PlaySpeed}else{a=this._TerrainView.getModule("military");var b=document.createElement("option");b.text="\u65b0\u589e\u885b\u661f...";this._SelectSatellite.innerHTML="";this._SelectSatellite.append(b);a=a._module.Scenes._StreamingEntities;for(b=0;b<a.length;b++){var c=document.createElement("option");c.text=a[b]._SatelliteName;this._SelectSatellite.append(c)}this._NameInput.value="";this._TLE1Input.value="";this._TLE2Input.value="";this._FovInput.value="";this._IconInput.value=
"";this._FovInput.value=45;this._IconSizeInput.value=30;this._ColorInput.value="#FF0000";this._OrbitDetailInput.value=90;this._ShowSatelliteInput.checked=!0;this._ShowOrbitInput.checked=!0;this._ShowViewConeInput.checked=!0;this._ShowGroundLineInput.checked=!0;this._PlaySpeedInput.value=1}};ov.Widget.SatelliteWidget.prototype.InsertContent=function(a,b){var c=document.createElement("div");c.classList.add("ov-widget-satelliteContentContainer");var d=document.createElement("div");d.classList.add("ov-widget-satelliteContentLabel");
d.innerText=a;c.append(d);a=document.createElement("div");a.append(b);c.append(a);this._UIContent.append(c)};ov.Widget.SatelliteWidget.prototype._initEvent=function(){this._UIHeader.addEventListener("mousedown",this._doMousedown.bind(this));this._SelectSatellite.addEventListener("change",function(a){this._InitInput(a.target.selectedIndex)}.bind(this));this._OkBtn.addEventListener("click",function(a){if(this._NameInput.value&&this._TLE1Input.value&&this._TLE2Input.value){a={tleTitle:this._NameInput.value,
tleLine1:this._TLE1Input.value,tleLine2:this._TLE2Input.value,icon:this._IconInput.value?this._IconInput.value:null,satelliteColor:this._ColorInput.value,showSatellite:this._ShowSatelliteInput.checked,showOrbit:this._ShowOrbitInput.checked,showViewCone:this._ShowViewConeInput.checked,showGroundLine:this._ShowGroundLineInput.checked};this._FovInput.value&&(a.satelliteFOV=parseFloat(this._FovInput.value));this._IconSizeInput.value&&(a.iconSize=parseFloat(this._IconSizeInput.value));this._OrbitDetailInput.value&&
(a.orbitDetail=parseFloat(this._OrbitDetailInput.value));this._PlaySpeedInput.value&&(a.playSpeed=parseFloat(this._PlaySpeedInput.value));var b=this._SelectSatellite.selectedIndex,c=this._TerrainView.getModule("military");b?(c._module.Scenes._StreamingEntities[b-1].UpdateParameter(a),a=new ov.MilitarySatelliteEntity(c._module.Scenes._StreamingEntities[b-1])):(a=c.addSatelliteEntity(a),this._InitInput());IsFunction(this._Callback)&&this._Callback(a)}else IsFunction(this._Callback)&&this._Callback(null,
"Invalid Name/TLE1/TLE2")}.bind(this));this._CancelBtn.addEventListener("click",function(a){IsFunction(this._Callback)&&this._Callback(null,"Exit");this.remove()}.bind(this));this._DeleteBtn.addEventListener("click",function(a){if(a=this._SelectSatellite.selectedIndex){var b=this._TerrainView.getModule("military");b._module.Scenes.RemoveEntity(b._module.Scenes._StreamingEntities[a-1]);this._InitInput()}}.bind(this))};ov.Widget.SatelliteWidget.prototype._doMousedown=function(a){if(0===a.button){a.preventDefault();
var b=function(d){d=new GeoPoint(d.clientX,d.clientY);var e=this._LastOffset.Sub(d);if(0!==e.x||0!==e.y)this._LastOffset=d,this._UIContainer.style.top=this._UIContainer.offsetTop-e.y+"px",this._UIContainer.style.left=this._UIContainer.offsetLeft-e.x+"px"}.bind(this),c=function(d){document.removeEventListener("mousemove",b);document.removeEventListener("mouseup",c)}.bind(this);document.addEventListener("mouseup",c);document.addEventListener("mousemove",b);this._LastOffset=new GeoPoint(a.clientX,a.clientY)}};
ov.Module.registerModuleWrapper("military",ov.MilitaryModule)}).call(this);

/*!
 * satellite-js v4.0.0
 * (c) 2013 Shashwat Kandadai and UCSC
 * https://github.com/shashwatak/satellite-js
 * License: MIT
 */

!function(o,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(o=o||self).satellite=t()}(this,function(){"use strict";var Ho=Math.PI,Yo=2*Ho,m=Ho/180,t=180/Ho,o=398600.5,Ao=6378.137,Bo=60/Math.sqrt(Ao*Ao*Ao/o),zo=Ao*Bo/60,p=1/Bo,Co=.00108262998905,s=-253215306e-14,Uo=-161098761e-14,Do=s/Co,Jo=2/3;function l(o,t){for(var s=[31,o%4==0?29:28,31,30,31,30,31,31,30,31,30,31],e=Math.floor(t),a=1,n=0;n+s[a-1]<e&&a<12;)n+=s[a-1],a+=1;var d=a,i=e-n,r=24*(t-e),c=Math.floor(r);r=60*(r-c);var h=Math.floor(r);return{mon:d,day:i,hr:c,minute:h,sec:60*(r-h)}}function r(o,t,s,e,a,n){var d=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0;return 367*o-Math.floor(7*(o+Math.floor((t+9)/12))*.25)+Math.floor(275*t/9)+s+1721013.5+((d/6e4+n/60+a)/60+e)/24}function x(o,t,s,e,a,n,d){if(o instanceof Date){var i=o;return r(i.getUTCFullYear(),i.getUTCMonth()+1,i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds(),i.getUTCMilliseconds())}return r(o,t,s,e,a,n,d)}function Ro(o,t){var s,e,a,n,d,i,r,c,h,m,p,l,x,g,M,f,u,z,v=o.e3,y=o.ee2,b=o.peo,q=o.pgho,w=o.pho,T=o.pinco,j=o.plo,E=o.se2,F=o.se3,L=o.sgh2,A=o.sgh3,C=o.sgh4,U=o.sh2,D=o.sh3,R=o.si2,S=o.si3,I=o.sl2,_=o.sl3,k=o.sl4,O=o.t,P=o.xgh2,Z=o.xgh3,G=o.xgh4,H=o.xh2,Y=o.xh3,B=o.xi2,J=o.xi3,K=o.xl2,N=o.xl3,Q=o.xl4,V=o.zmol,W=o.zmos,X=t.init,$=t.opsmode,oo=t.ep,to=t.inclp,so=t.nodep,eo=t.argpp,ao=t.mp;z=W+119459e-10*O,"y"===X&&(z=W),u=z+.0335*Math.sin(z);var no=E*(r=.5*(g=Math.sin(u))*g-.25)+F*(c=-.5*g*Math.cos(u)),io=R*r+S*c,ro=I*r+_*c+k*g,co=L*r+A*c+C*g,ho=U*r+D*c;return z=V+.00015835218*O,"y"===X&&(z=V),u=z+.1098*Math.sin(z),h=no+(y*(r=.5*(g=Math.sin(u))*g-.25)+v*(c=-.5*g*Math.cos(u))),l=io+(B*r+J*c),x=ro+(K*r+N*c+Q*g),m=co+(P*r+Z*c+G*g),p=ho+(H*r+Y*c),"n"===X&&(x-=j,m-=q,p-=w,to+=l-=T,oo+=h-=b,n=Math.sin(to),a=Math.cos(to),.2<=to?(eo+=m-=a*(p/=n),so+=p,ao+=x):(s=n*(i=Math.sin(so)),e=n*(d=Math.cos(so)),s+=p*d+l*a*i,e+=-p*i+l*a*d,(so%=Yo)<0&&"a"===$&&(so+=Yo),M=ao+eo+a*so,M+=x+m-l*so*n,f=so,(so=Math.atan2(s,e))<0&&"a"===$&&(so+=Yo),Math.abs(f-so)>Ho&&(so<f?so+=Yo:so-=Yo),eo=M-(ao+=x)-a*so)),{ep:oo,inclp:to,nodep:so,argpp:eo,mp:ao}}function e(o){var t=(o-2451545)/36525,s=-62e-7*t*t*t+.093104*t*t+3164400184.812866*t+67310.54841;return(s=s*m/240%Yo)<0&&(s+=Yo),s}function So(){return(arguments.length<=0?void 0:arguments[0])instanceof Date||1<arguments.length?e(x.apply(void 0,arguments)):e.apply(void 0,arguments)}function Io(o,t){var s,e,a,n,d,i,r,c,h,m,p,l,x,g,M,f,u,z,v,y,b,q,w,T,j,E;o.t=t,o.error=0;var F=o.mo+o.mdot*o.t,L=o.argpo+o.argpdot*o.t,A=o.nodeo+o.nodedot*o.t;c=L,y=F;var C=o.t*o.t;if(q=A+o.nodecf*C,f=1-o.cc1*o.t,u=o.bstar*o.cc4*o.t,z=o.t2cof*C,1!==o.isimp){i=o.omgcof*o.t;var U=1+o.eta*Math.cos(F);y=F+(M=i+o.xmcof*(U*U*U-o.delmo)),c=L-M,l=(p=C*o.t)*o.t,f=f-o.d2*C-o.d3*p-o.d4*l,u+=o.bstar*o.cc5*(Math.sin(y)-o.sinmao),z=z+o.t3cof*p+l*(o.t4cof+o.t*o.t5cof)}b=o.no;var D=o.ecco;if(v=o.inclo,"d"===o.method){x=o.t;var R=function(o){var t,s,e,a,n,d,i,r,c=o.irez,h=o.d2201,m=o.d2211,p=o.d3210,l=o.d3222,x=o.d4410,g=o.d4422,M=o.d5220,f=o.d5232,u=o.d5421,z=o.d5433,v=o.dedt,y=o.del1,b=o.del2,q=o.del3,w=o.didt,T=o.dmdt,j=o.dnodt,E=o.domdt,F=o.argpo,L=o.argpdot,A=o.t,C=o.tc,U=o.gsto,D=o.xfact,R=o.xlamo,S=o.no,I=o.atime,_=o.em,k=o.argpm,O=o.inclm,P=o.xli,Z=o.mm,G=o.xni,H=o.nodem,Y=o.nm,B=.13130908,J=2.8843198,K=.37448087,N=5.7686396,Q=.95240898,V=1.8014998,W=1.050833,X=4.4108898,$=0,oo=0,to=(U+.0043752690880113*C)%Yo;if(_+=v*A,O+=w*A,k+=E*A,H+=j*A,Z+=T*A,0!==c){(0===I||A*I<=0||Math.abs(A)<Math.abs(I))&&(I=0,G=S,P=R),t=0<A?720:-720;for(var so=381;381===so;)d=2!==c?(i=y*Math.sin(P-B)+b*Math.sin(2*(P-J))+q*Math.sin(3*(P-K)),n=G+D,y*Math.cos(P-B)+2*b*Math.cos(2*(P-J))+3*q*Math.cos(3*(P-K))):(e=(r=F+L*I)+r,s=P+P,i=h*Math.sin(e+P-N)+m*Math.sin(P-N)+p*Math.sin(r+P-Q)+l*Math.sin(-r+P-Q)+x*Math.sin(e+s-V)+g*Math.sin(s-V)+M*Math.sin(r+P-W)+f*Math.sin(-r+P-W)+u*Math.sin(r+s-X)+z*Math.sin(-r+s-X),n=G+D,h*Math.cos(e+P-N)+m*Math.cos(P-N)+p*Math.cos(r+P-Q)+l*Math.cos(-r+P-Q)+M*Math.cos(r+P-W)+f*Math.cos(-r+P-W)+2*x*Math.cos(e+s-V)+g*Math.cos(s-V)+u*Math.cos(r+s-X)+z*Math.cos(-r+s-X)),d*=n,381==(so=720<=Math.abs(A-I)?381:(oo=A-I,0))&&(P+=n*t+259200*i,G+=i*t+259200*d,I+=t);a=P+n*oo+i*oo*oo*.5,Y=S+(Z=1!==c?a-2*H+2*to:a-H-k+to,$=(Y=G+i*oo+d*oo*oo*.5)-S)}return{atime:I,em:_,argpm:k,inclm:O,xli:P,mm:Z,xni:G,nodem:H,dndt:$,nm:Y}}({irez:o.irez,d2201:o.d2201,d2211:o.d2211,d3210:o.d3210,d3222:o.d3222,d4410:o.d4410,d4422:o.d4422,d5220:o.d5220,d5232:o.d5232,d5421:o.d5421,d5433:o.d5433,dedt:o.dedt,del1:o.del1,del2:o.del2,del3:o.del3,didt:o.didt,dmdt:o.dmdt,dnodt:o.dnodt,domdt:o.domdt,argpo:o.argpo,argpdot:o.argpdot,t:o.t,tc:x,gsto:o.gsto,xfact:o.xfact,xlamo:o.xlamo,no:o.no,atime:o.atime,em:D,argpm:c,inclm:v,xli:o.xli,mm:y,xni:o.xni,nodem:q,nm:b});D=R.em,c=R.argpm,v=R.inclm,y=R.mm,q=R.nodem,b=R.nm}if(b<=0)return[!(o.error=2),!1];var S=Math.pow(Bo/b,Jo)*f*f;if(b=Bo/Math.pow(S,1.5),1<=(D-=u)||D<-.001)return[!(o.error=1),!1];D<1e-6&&(D=1e-6),T=(y+=o.no*z)+c+q;var I=D;if(w=v,h=c%=Yo,E=q%=Yo,j=y=((T%=Yo)-c-q)%Yo,n=Math.sin(v),a=Math.cos(v),"d"===o.method){var _=Ro(o,{inclo:o.inclo,init:"n",ep:I,inclp:w,nodep:E,argpp:h,mp:j,opsmode:o.operationmode});if(I=_.ep,E=_.nodep,h=_.argpp,j=_.mp,(w=_.inclp)<0&&(w=-w,E+=Ho,h-=Ho),I<0||1<I)return[!(o.error=3),!1]}"d"===o.method&&(n=Math.sin(w),a=Math.cos(w),o.aycof=-.5*Do*n,15e-13<Math.abs(a+1)?o.xlcof=-.25*Do*n*(3+5*a)/(1+a):o.xlcof=-.25*Do*n*(3+5*a)/15e-13);var k=I*Math.cos(h);M=1/(S*(1-I*I));var O=I*Math.sin(h)+M*o.aycof,P=(j+h+E+M*o.xlcof*k-E)%Yo;r=P,g=9999.9;for(var Z=1;1e-12<=Math.abs(g)&&Z<=10;)e=Math.sin(r),g=(P-O*(s=Math.cos(r))+k*e-r)/(g=1-s*k-e*O),.95<=Math.abs(g)&&(g=0<g?.95:-.95),r+=g,Z+=1;var G=k*s+O*e,H=k*e-O*s,Y=k*k+O*O,B=S*(1-Y);if(B<0)return[!(o.error=4),!1];var J=S*(1-G),K=Math.sqrt(S)*H/J,N=Math.sqrt(B)/J,Q=Math.sqrt(1-Y),V=S/J*(e-O-k*(M=H/(1+Q))),W=S/J*(s-k+O*M);m=Math.atan2(V,W);var X=(W+W)*V,$=1-2*V*V,oo=.5*Co*(M=1/B),to=oo*M;"d"===o.method&&(d=a*a,o.con41=3*d-1,o.x1mth2=1-d,o.x7thm1=7*d-1);var so=J*(1-1.5*to*Q*o.con41)+.5*oo*o.x1mth2*$;if(so<1)return{position:!(o.error=6),velocity:!1};m-=.25*to*o.x7thm1*X;var eo=E+1.5*to*a*X,ao=w+1.5*to*a*n*$,no=K-b*oo*o.x1mth2*X/Bo,io=N+b*oo*(o.x1mth2*$+1.5*o.con41)/Bo,ro=Math.sin(m),co=Math.cos(m),ho=Math.sin(eo),mo=Math.cos(eo),po=Math.sin(ao),lo=Math.cos(ao),xo=-ho*lo,go=mo*lo,Mo=xo*ro+mo*co,fo=go*ro+ho*co,uo=po*ro;return{position:{x:so*Mo*Ao,y:so*fo*Ao,z:so*uo*Ao},velocity:{x:(no*Mo+io*(xo*co-mo*ro))*zo,y:(no*fo+io*(go*co-ho*ro))*zo,z:(no*uo+io*(po*co))*zo}}}function g(o,t){var s,e,a,n,d,i,r,c,h,m,p,l,x,g,M,f,u,z,v,y,b,q,w,T,j,E,F,L,A,C,U,D,R,S,I,_,k,O,P,Z,G,H,Y,B,J,K,N,Q,V,W,X,$,oo=t.opsmode,to=t.satn,so=t.epoch,eo=t.xbstar,ao=t.xecco,no=t.xargpo,io=t.xinclo,ro=t.xmo,co=t.xno,ho=t.xnodeo;o.isimp=0,o.method="n",o.aycof=0,o.con41=0,o.cc1=0,o.cc4=0,o.cc5=0,o.d2=0,o.d3=0,o.d4=0,o.delmo=0,o.eta=0,o.argpdot=0,o.omgcof=0,o.sinmao=0,o.t=0,o.t2cof=0,o.t3cof=0,o.t4cof=0,o.t5cof=0,o.x1mth2=0,o.x7thm1=0,o.mdot=0,o.nodedot=0,o.xlcof=0,o.xmcof=0,o.nodecf=0,o.irez=0,o.d2201=0,o.d2211=0,o.d3210=0,o.d3222=0,o.d4410=0,o.d4422=0,o.d5220=0,o.d5232=0,o.d5421=0,o.d5433=0,o.dedt=0,o.del1=0,o.del2=0,o.del3=0,o.didt=0,o.dmdt=0,o.dnodt=0,o.domdt=0,o.e3=0,o.ee2=0,o.peo=0,o.pgho=0,o.pho=0,o.pinco=0,o.plo=0,o.se2=0,o.se3=0,o.sgh2=0,o.sgh3=0,o.sgh4=0,o.sh2=0,o.sh3=0,o.si2=0,o.si3=0,o.sl2=0,o.sl3=0,o.sl4=0,o.gsto=0,o.xfact=0,o.xgh2=0,o.xgh3=0,o.xgh4=0,o.xh2=0,o.xh3=0,o.xi2=0,o.xi3=0,o.xl2=0,o.xl3=0,o.xl4=0,o.xlamo=0,o.zmol=0,o.zmos=0,o.atime=0,o.xli=0,o.xni=0,o.bstar=eo,o.ecco=ao,o.argpo=no,o.inclo=io,o.mo=ro,o.no=co,o.nodeo=ho,o.operationmode=oo;var mo=78/Ao+1,po=42/Ao,lo=po*po*po*po;o.init="y",o.t=0;var xo=function(o){var t=o.ecco,s=o.epoch,e=o.inclo,a=o.opsmode,n=o.no,d=t*t,i=1-d,r=Math.sqrt(i),c=Math.cos(e),h=c*c,m=Math.pow(Bo/n,Jo),p=.75*Co*(3*h-1)/(r*i),l=p/(m*m),x=m*(1-l*l-l*(1/3+134*l*l/81));n/=1+(l=p/(x*x));var g,M=Math.pow(Bo/n,Jo),f=Math.sin(e),u=M*i,z=1-5*h,v=-z-h-h,y=1/M,b=u*u,q=M*(1-t);if("a"===a){var w=s-7305,T=Math.floor(w+1e-8),j=.017202791694070362;(g=(1.7321343856509375+j*T+(j+Yo)*(w-T)+w*w*5075514194322695e-30)%Yo)<0&&(g+=Yo)}else g=So(s+2433281.5);return{no:n,method:"n",ainv:y,ao:M,con41:v,con42:z,cosio:c,cosio2:h,eccsq:d,omeosq:i,posq:b,rp:q,rteosq:r,sinio:f,gsto:g}}({satn:to,ecco:o.ecco,epoch:so,inclo:o.inclo,no:o.no,method:o.method,opsmode:o.operationmode}),go=xo.ao,Mo=xo.con42,fo=xo.cosio,uo=xo.cosio2,zo=xo.eccsq,vo=xo.omeosq,yo=xo.posq,bo=xo.rp,qo=xo.rteosq,wo=xo.sinio;if(o.no=xo.no,o.con41=xo.con41,o.gsto=xo.gsto,(o.error=0)<=vo||0<=o.no){if(o.isimp=0,bo<220/Ao+1&&(o.isimp=1),T=mo,z=lo,(M=(bo-1)*Ao)<156){T=M-78,M<98&&(T=20);var To=(120-T)/Ao;z=To*To*To*To,T=T/Ao+1}f=1/yo,H=1/(go-T),o.eta=go*o.ecco*H,l=o.eta*o.eta,p=o.ecco*o.eta,u=Math.abs(1-l),n=(r=(i=z*Math.pow(H,4))/Math.pow(u,3.5))*o.no*(go*(1+1.5*l+p*(4+l))+.375*Co*H/u*o.con41*(8+3*l*(8+l))),o.cc1=o.bstar*n,d=0,1e-4<o.ecco&&(d=-2*i*H*Do*o.no*wo/o.ecco),o.x1mth2=1-uo,o.cc4=2*o.no*r*go*vo*(o.eta*(2+.5*l)+o.ecco*(.5+2*l)-Co*H/(go*u)*(-3*o.con41*(1-2*p+l*(1.5-.5*p))+.75*o.x1mth2*(2*l-p*(1+l))*Math.cos(2*o.argpo))),o.cc5=2*r*go*vo*(1+2.75*(l+p)+p*l),c=uo*uo,Z=.5*(P=1.5*Co*f*o.no)*Co*f,G=-.46875*Uo*f*f*o.no,o.mdot=o.no+.5*P*qo*o.con41+.0625*Z*qo*(13-78*uo+137*c),o.argpdot=-.5*P*Mo+.0625*Z*(7-114*uo+395*c)+G*(3-36*uo+49*c),B=-P*fo,o.nodedot=B+(.5*Z*(4-19*uo)+2*G*(3-7*uo))*fo,Y=o.argpdot+o.nodedot,o.omgcof=o.bstar*d*Math.cos(o.argpo),o.xmcof=0,1e-4<o.ecco&&(o.xmcof=-Jo*i*o.bstar/p),o.nodecf=3.5*vo*B*o.cc1,o.t2cof=1.5*o.cc1,15e-13<Math.abs(fo+1)?o.xlcof=-.25*Do*wo*(3+5*fo)/(1+fo):o.xlcof=-.25*Do*wo*(3+5*fo)/15e-13,o.aycof=-.5*Do*wo;var jo=1+o.eta*Math.cos(o.mo);if(o.delmo=jo*jo*jo,o.sinmao=Math.sin(o.mo),o.x7thm1=7*uo-1,225<=2*Ho/o.no){o.method="d",o.isimp=1,0,x=o.inclo;var Eo=function(o){var t,s,e,a,n,d,i,r,c,h,m,p,l,x,g,M,f,u,z,v,y,b,q,w,T,j,E,F,L,A,C,U,D,R,S,I,_,k,O,P,Z,G,H,Y,B,J,K,N,Q,V,W,X,$,oo,to,so,eo,ao,no,io,ro,co,ho,mo=o.epoch,po=o.ep,lo=o.argpp,xo=o.tc,go=o.inclp,Mo=o.nodep,fo=o.np,uo=po,zo=Math.sin(Mo),vo=Math.cos(Mo),yo=Math.sin(lo),bo=Math.cos(lo),qo=Math.sin(go),wo=Math.cos(go),To=uo*uo,jo=1-To,Eo=Math.sqrt(jo),Fo=mo+18261.5+xo/1440,Lo=(4.523602-.00092422029*Fo)%Yo,Ao=Math.sin(Lo),Co=Math.cos(Lo),Uo=.91375164-.03568096*Co,Do=Math.sqrt(1-Uo*Uo),Ro=.089683511*Ao/Do,So=Math.sqrt(1-Ro*Ro),Io=5.8351514+.001944368*Fo,_o=.39785416*Ao/Do,ko=So*Co+.91744867*Ro*Ao;_o=Math.atan2(_o,ko),_o+=Io-Lo;var Oo=Math.cos(_o),Po=Math.sin(_o);v=.1945905,y=-.98088458,w=.91744867,T=.39785416,b=vo,q=zo,m=29864797e-13;for(var Zo=1/fo,Go=0;Go<2;)to=-6*(t=v*b+y*w*q)*(n=-qo*(i=-v*q+y*w*b)+wo*(r=y*T))+To*(-24*(p=t*bo+(s=wo*i+qo*r)*yo)*(u=n*bo)-6*(x=-t*yo+s*bo)*(M=n*yo)),so=-6*(t*(d=-qo*(c=y*q+v*w*b)+wo*(h=v*T))+(e=-y*b+v*w*q)*n)+To*(-24*((l=e*bo+(a=wo*c+qo*h)*yo)*u+p*(z=d*bo))+-6*(x*(f=d*yo)+(g=-e*yo+a*bo)*M)),eo=-6*e*d+To*(-24*l*z-6*g*f),ao=6*s*n+To*(24*p*M-6*x*u),no=6*(a*n+s*d)+To*(24*(l*M+p*f)-6*(g*u+x*z)),io=6*a*d+To*(24*l*f-6*g*z),X=(X=3*(t*t+s*s)+(ro=12*p*p-3*x*x)*To)+X+jo*ro,$=($=6*(t*e+s*a)+(co=24*p*l-6*x*g)*To)+$+jo*co,oo=(oo=3*(e*e+a*a)+(ho=12*l*l-3*g*g)*To)+oo+jo*ho,J=-.5*(K=m*Zo)/Eo,B=-15*uo*(N=K*Eo),Q=p*x+l*g,V=l*x+p*g,W=l*g-p*x,1===(Go+=1)&&(j=B,E=J,F=K,L=N,A=Q,C=V,U=W,D=X,R=$,S=oo,I=to,_=so,k=eo,O=ao,P=no,Z=io,G=ro,H=co,Y=ho,v=Oo,y=Po,w=Uo,T=Do,b=So*vo+Ro*zo,q=zo*So-vo*Ro,m=4.7968065e-7);return{snodm:zo,cnodm:vo,sinim:qo,cosim:wo,sinomm:yo,cosomm:bo,day:Fo,e3:2*B*W,ee2:2*B*V,em:uo,emsq:To,gam:Io,peo:0,pgho:0,pho:0,pinco:0,plo:0,rtemsq:Eo,se2:2*j*C,se3:2*j*U,sgh2:2*L*H,sgh3:2*L*(Y-G),sgh4:-18*L*.01675,sh2:-2*E*P,sh3:-2*E*(Z-O),si2:2*E*_,si3:2*E*(k-I),sl2:-2*F*R,sl3:-2*F*(S-D),sl4:-2*F*(-21-9*To)*.01675,s1:B,s2:J,s3:K,s4:N,s5:Q,s6:V,s7:W,ss1:j,ss2:E,ss3:F,ss4:L,ss5:A,ss6:C,ss7:U,sz1:D,sz2:R,sz3:S,sz11:I,sz12:_,sz13:k,sz21:O,sz22:P,sz23:Z,sz31:G,sz32:H,sz33:Y,xgh2:2*N*co,xgh3:2*N*(ho-ro),xgh4:-18*N*.0549,xh2:-2*J*no,xh3:-2*J*(io-ao),xi2:2*J*so,xi3:2*J*(eo-to),xl2:-2*K*$,xl3:-2*K*(oo-X),xl4:-2*K*(-21-9*To)*.0549,nm:fo,z1:X,z2:$,z3:oo,z11:to,z12:so,z13:eo,z21:ao,z22:no,z23:io,z31:ro,z32:co,z33:ho,zmol:(.2299715*Fo-Io+4.7199672)%Yo,zmos:(6.2565837+.017201977*Fo)%Yo}}({epoch:so,ep:o.ecco,argpp:o.argpo,tc:0,inclp:o.inclo,nodep:o.nodeo,np:o.no,e3:o.e3,ee2:o.ee2,peo:o.peo,pgho:o.pgho,pho:o.pho,pinco:o.pinco,plo:o.plo,se2:o.se2,se3:o.se3,sgh2:o.sgh2,sgh3:o.sgh3,sgh4:o.sgh4,sh2:o.sh2,sh3:o.sh3,si2:o.si2,si3:o.si3,sl2:o.sl2,sl3:o.sl3,sl4:o.sl4,xgh2:o.xgh2,xgh3:o.xgh3,xgh4:o.xgh4,xh2:o.xh2,xh3:o.xh3,xi2:o.xi2,xi3:o.xi3,xl2:o.xl2,xl3:o.xl3,xl4:o.xl4,zmol:o.zmol,zmos:o.zmos});o.e3=Eo.e3,o.ee2=Eo.ee2,o.peo=Eo.peo,o.pgho=Eo.pgho,o.pho=Eo.pho,o.pinco=Eo.pinco,o.plo=Eo.plo,o.se2=Eo.se2,o.se3=Eo.se3,o.sgh2=Eo.sgh2,o.sgh3=Eo.sgh3,o.sgh4=Eo.sgh4,o.sh2=Eo.sh2,o.sh3=Eo.sh3,o.si2=Eo.si2,o.si3=Eo.si3,o.sl2=Eo.sl2,o.sl3=Eo.sl3,o.sl4=Eo.sl4,e=Eo.sinim,s=Eo.cosim,h=Eo.em,m=Eo.emsq,v=Eo.s1,y=Eo.s2,b=Eo.s3,q=Eo.s4,w=Eo.s5,j=Eo.ss1,E=Eo.ss2,F=Eo.ss3,L=Eo.ss4,A=Eo.ss5,C=Eo.sz1,U=Eo.sz3,D=Eo.sz11,R=Eo.sz13,S=Eo.sz21,I=Eo.sz23,_=Eo.sz31,k=Eo.sz33,o.xgh2=Eo.xgh2,o.xgh3=Eo.xgh3,o.xgh4=Eo.xgh4,o.xh2=Eo.xh2,o.xh3=Eo.xh3,o.xi2=Eo.xi2,o.xi3=Eo.xi3,o.xl2=Eo.xl2,o.xl3=Eo.xl3,o.xl4=Eo.xl4,o.zmol=Eo.zmol,o.zmos=Eo.zmos,g=Eo.nm,J=Eo.z1,K=Eo.z3,N=Eo.z11,Q=Eo.z13,V=Eo.z21,W=Eo.z23,X=Eo.z31,$=Eo.z33;var Fo=Ro(o,{inclo:x,init:o.init,ep:o.ecco,inclp:o.inclo,nodep:o.nodeo,argpp:o.argpo,mp:o.mo,opsmode:o.operationmode});o.ecco=Fo.ep,o.inclo=Fo.inclp,o.nodeo=Fo.nodep,o.argpo=Fo.argpp,o.mo=Fo.mp,0;var Lo=function(o){var t,s,e,a,n,d,i,r,c,h,m,p,l,x,g,M,f=o.cosim,u=o.argpo,z=o.s1,v=o.s2,y=o.s3,b=o.s4,q=o.s5,w=o.sinim,T=o.ss1,j=o.ss2,E=o.ss3,F=o.ss4,L=o.ss5,A=o.sz1,C=o.sz3,U=o.sz11,D=o.sz13,R=o.sz21,S=o.sz23,I=o.sz31,_=o.sz33,k=o.t,O=o.tc,P=o.gsto,Z=o.mo,G=o.mdot,H=o.no,Y=o.nodeo,B=o.nodedot,J=o.xpidot,K=o.z1,N=o.z3,Q=o.z11,V=o.z13,W=o.z21,X=o.z23,$=o.z31,oo=o.z33,to=o.ecco,so=o.eccsq,eo=o.emsq,ao=o.em,no=o.argpm,io=o.inclm,ro=o.mm,co=o.nm,ho=o.nodem,mo=o.irez,po=o.atime,lo=o.d2201,xo=o.d2211,go=o.d3210,Mo=o.d3222,fo=o.d4410,uo=o.d4422,zo=o.d5220,vo=o.d5232,yo=o.d5421,bo=o.d5433,qo=o.dedt,wo=o.didt,To=o.dmdt,jo=o.dnodt,Eo=o.domdt,Fo=o.del1,Lo=o.del2,Ao=o.del3,Co=o.xfact,Uo=o.xlamo,Do=o.xli,Ro=o.xni,So=.0043752690880113,Io=.00015835218,_o=119459e-10;mo=0,co<.0052359877&&.0034906585<co&&(mo=1),.00826<=co&&co<=.00924&&.5<=ao&&(mo=2);var ko=-_o*j*(R+S);(io<.052359877||Ho-.052359877<io)&&(ko=0),0!==w&&(ko/=w);var Oo=-Io*v*(W+X);(io<.052359877||Ho-.052359877<io)&&(Oo=0),Eo=F*_o*(I+_-6)-f*ko+b*Io*($+oo-6),jo=ko,0!==w&&(Eo-=f/w*Oo,jo+=Oo/w);var Po=(P+O*So)%Yo;if(ao+=(qo=T*_o*L+z*Io*q)*k,io+=(wo=j*_o*(U+D)+v*Io*(Q+V))*k,no+=Eo*k,ho+=jo*k,ro+=(To=-_o*E*(A+C-14-6*eo)-Io*y*(K+N-14-6*eo))*k,0!==mo){if(x=Math.pow(co/Bo,Jo),2===mo){var Zo=ao,Go=eo;M=(ao=to)*(eo=so),r=ao<=.65?(e=3.616-13.247*ao+16.29*eo,a=117.39*ao-19.302-228.419*eo+156.591*M,n=109.7927*ao-18.9068-214.6334*eo+146.5816*M,d=242.694*ao-41.122-471.094*eo+313.953*M,i=841.88*ao-146.407-1629.014*eo+1083.435*M,3017.977*ao-532.114-5740.032*eo+3708.276*M):(e=331.819*ao-72.099-508.738*eo+266.724*M,a=1582.851*ao-346.844-2415.925*eo+1246.113*M,n=1554.908*ao-342.585-2366.899*eo+1215.972*M,d=4758.686*ao-1052.797-7193.992*eo+3651.957*M,i=16178.11*ao-3581.69-24462.77*eo+12422.52*M,.715<ao?29936.92*ao-5149.66-54087.36*eo+31324.56*M:1464.74-4664.75*ao+3763.64*eo),lo=(p=17891679e-13*(l=co*co*3*(x*x)))*(t=.75*(1+2*f+(g=f*f)))*(-.306-.44*(ao-.64)),xo=p*(1.5*(m=w*w))*e,go=(p=3.7393792e-7*(l*=x))*(1.875*w*(1-2*f-3*g))*a,Mo=p*(-1.875*w*(1+2*f-3*g))*n,fo=(p=2*(l*=x)*7.3636953e-9)*(35*m*t)*d,uo=p*(39.375*m*m)*i,zo=(p=1.1428639e-7*(l*=x))*(9.84375*w*(m*(1-2*f-5*g)+.33333333*(4*f-2+6*g)))*r,vo=p*(w*(4.92187512*m*(-2-4*f+10*g)+6.56250012*(1+2*f-3*g)))*(ao<.7?(h=4988.61*ao-919.2277-9064.77*eo+5542.21*M,c=4568.6173*ao-822.71072-8491.4146*eo+5337.524*M,4690.25*ao-853.666-8624.77*eo+5341.4*M):(h=161616.52*ao-37995.78-229838.2*eo+109377.94*M,c=218913.95*ao-51752.104-309468.16*eo+146349.42*M,170470.89*ao-40023.88-242699.48*eo+115605.82*M)),yo=(p=2*l*2.1765803e-9)*(29.53125*w*(2-8*f+g*(8*f-12+10*g)))*c,bo=p*(29.53125*w*(-2-8*f+g*(12+8*f-10*g)))*h,Uo=(Z+Y+Y-(Po+Po))%Yo,Co=G+To+2*(B+jo-So)-H,ao=Zo,eo=Go}1===mo&&(Lo=2*(Fo=3*co*co*x*x)*(t=.75*(s=1+f)*(1+f))*(1+eo*(.8125*eo-2.5))*17891679e-13,Ao=3*Fo*(s*=1.875*s*s)*(1+eo*(6.60937*eo-6))*2.2123015e-7*x,Fo=Fo*(.9375*w*w*(1+3*f)-.75*(1+f))*(a=1+2*eo)*21460748e-13*x,Uo=(Z+Y+u-Po)%Yo,Co=G+J+To+Eo+jo-(H+So)),Do=Uo,co=(Ro=H)+(po=0)}return{em:ao,argpm:no,inclm:io,mm:ro,nm:co,nodem:ho,irez:mo,atime:po,d2201:lo,d2211:xo,d3210:go,d3222:Mo,d4410:fo,d4422:uo,d5220:zo,d5232:vo,d5421:yo,d5433:bo,dedt:qo,didt:wo,dmdt:To,dndt:0,dnodt:jo,domdt:Eo,del1:Fo,del2:Lo,del3:Ao,xfact:Co,xlamo:Uo,xli:Do,xni:Ro}}({cosim:s,emsq:m,argpo:o.argpo,s1:v,s2:y,s3:b,s4:q,s5:w,sinim:e,ss1:j,ss2:E,ss3:F,ss4:L,ss5:A,sz1:C,sz3:U,sz11:D,sz13:R,sz21:S,sz23:I,sz31:_,sz33:k,t:o.t,tc:0,gsto:o.gsto,mo:o.mo,mdot:o.mdot,no:o.no,nodeo:o.nodeo,nodedot:o.nodedot,xpidot:Y,z1:J,z3:K,z11:N,z13:Q,z21:V,z23:W,z31:X,z33:$,ecco:o.ecco,eccsq:zo,em:h,argpm:0,inclm:x,mm:0,nm:g,nodem:0,irez:o.irez,atime:o.atime,d2201:o.d2201,d2211:o.d2211,d3210:o.d3210,d3222:o.d3222,d4410:o.d4410,d4422:o.d4422,d5220:o.d5220,d5232:o.d5232,d5421:o.d5421,d5433:o.d5433,dedt:o.dedt,didt:o.didt,dmdt:o.dmdt,dnodt:o.dnodt,domdt:o.domdt,del1:o.del1,del2:o.del2,del3:o.del3,xfact:o.xfact,xlamo:o.xlamo,xli:o.xli,xni:o.xni});o.irez=Lo.irez,o.atime=Lo.atime,o.d2201=Lo.d2201,o.d2211=Lo.d2211,o.d3210=Lo.d3210,o.d3222=Lo.d3222,o.d4410=Lo.d4410,o.d4422=Lo.d4422,o.d5220=Lo.d5220,o.d5232=Lo.d5232,o.d5421=Lo.d5421,o.d5433=Lo.d5433,o.dedt=Lo.dedt,o.didt=Lo.didt,o.dmdt=Lo.dmdt,o.dnodt=Lo.dnodt,o.domdt=Lo.domdt,o.del1=Lo.del1,o.del2=Lo.del2,o.del3=Lo.del3,o.xfact=Lo.xfact,o.xlamo=Lo.xlamo,o.xli=Lo.xli,o.xni=Lo.xni}1!==o.isimp&&(a=o.cc1*o.cc1,o.d2=4*go*H*a,O=o.d2*H*o.cc1/3,o.d3=(17*go+T)*O,o.d4=.5*O*go*H*(221*go+31*T)*o.cc1,o.t3cof=o.d2+2*a,o.t4cof=.25*(3*o.d3+o.cc1*(12*o.d2+10*a)),o.t5cof=.2*(3*o.d4+12*o.cc1*o.d3+6*o.d2*o.d2+15*a*(2*o.d2+a)))}Io(o,0),o.init="n"}function n(o){return function(o){if(Array.isArray(o)){for(var t=0,s=new Array(o.length);t<o.length;t++)s[t]=o[t];return s}}(o)||function(o){if(Symbol.iterator in Object(o)||"[object Arguments]"===Object.prototype.toString.call(o))return Array.from(o)}(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function a(o){return o*t}function d(o){return o*m}function f(o){var t=o.longitude,s=o.latitude,e=o.height,a=6378.137,n=.0033528106718309306,d=2*n-n*n,i=a/Math.sqrt(1-d*(Math.sin(s)*Math.sin(s)));return{x:(i+e)*Math.cos(s)*Math.cos(t),y:(i+e)*Math.cos(s)*Math.sin(t),z:(i*(1-d)+e)*Math.sin(s)}}return{constants:Object.freeze({__proto__:null,pi:Ho,twoPi:Yo,deg2rad:m,rad2deg:t,minutesPerDay:1440,mu:o,earthRadius:Ao,xke:Bo,vkmpersec:zo,tumin:p,j2:Co,j3:s,j4:Uo,j3oj2:Do,x2o3:Jo}),propagate:function(){for(var o=arguments.length,t=new Array(o),s=0;s<o;s++)t[s]=arguments[s];var e=t[0],a=Array.prototype.slice.call(t,1);return Io(e,1440*(x.apply(void 0,n(a))-e.jdsatepoch))},sgp4:Io,twoline2satrec:function(o,t){var s=1440/(2*Ho),e=0,a={error:0};a.satnum=o.substring(2,7),a.epochyr=parseInt(o.substring(18,20),10),a.epochdays=parseFloat(o.substring(20,32)),a.ndot=parseFloat(o.substring(33,43)),a.nddot=parseFloat(".".concat(parseInt(o.substring(44,50),10),"E").concat(o.substring(50,52))),a.bstar=parseFloat("".concat(o.substring(53,54),".").concat(parseInt(o.substring(54,59),10),"E").concat(o.substring(59,61))),a.inclo=parseFloat(t.substring(8,16)),a.nodeo=parseFloat(t.substring(17,25)),a.ecco=parseFloat(".".concat(t.substring(26,33))),a.argpo=parseFloat(t.substring(34,42)),a.mo=parseFloat(t.substring(43,51)),a.no=parseFloat(t.substring(52,63)),a.no/=s,a.a=Math.pow(a.no*p,-2/3),a.ndot/=1440*s,a.nddot/=1440*s*1440,a.inclo*=m,a.nodeo*=m,a.argpo*=m,a.mo*=m,a.alta=a.a*(1+a.ecco)-1,a.altp=a.a*(1-a.ecco)-1;var n=l(e=a.epochyr<57?a.epochyr+2e3:a.epochyr+1900,a.epochdays),d=n.mon,i=n.day,r=n.hr,c=n.minute,h=n.sec;return a.jdsatepoch=x(e,d,i,r,c,h),g(a,{opsmode:"i",satn:a.satnum,epoch:a.jdsatepoch-2433281.5,xbstar:a.bstar,xecco:a.ecco,xargpo:a.argpo,xinclo:a.inclo,xmo:a.mo,xno:a.no,xnodeo:a.nodeo}),a},gstime:So,jday:x,invjday:function(o,t){var s=o-2415019.5,e=s/365.25,a=1900+Math.floor(e),n=Math.floor(.25*(a-1901)),d=s-(365*(a-1900)+n)+1e-11;d<1&&(d=s-(365*((a-=1)-1900)+(n=Math.floor(.25*(a-1901)))));var i=l(a,d),r=i.mon,c=i.day,h=i.hr,m=i.minute,p=i.sec-864e-9;return t?[a,r,c,h,m,Math.floor(p)]:new Date(Date.UTC(a,r-1,c,h,m,Math.floor(p)))},dopplerFactor:function(o,t,s){var e=Math.sqrt(Math.pow(t.x-o.x,2)+Math.pow(t.y-o.y,2)+Math.pow(t.z-o.z,2)),a=t.x+s.x,n=t.y+s.y,d=t.z+s.z,i=Math.sqrt(Math.pow(a-o.x,2)+Math.pow(n-o.y,2)+Math.pow(d-o.z,2))-e;return 1+(i*=0<=i?1:-1)/299792.458},radiansToDegrees:a,degreesToRadians:d,degreesLat:function(o){if(o<-Ho/2||Ho/2<o)throw new RangeError("Latitude radians must be in range [-pi/2; pi/2].");return a(o)},degreesLong:function(o){if(o<-Ho||Ho<o)throw new RangeError("Longitude radians must be in range [-pi; pi].");return a(o)},radiansLat:function(o){if(o<-90||90<o)throw new RangeError("Latitude degrees must be in range [-90; 90].");return d(o)},radiansLong:function(o){if(o<-180||180<o)throw new RangeError("Longitude degrees must be in range [-180; 180].");return d(o)},geodeticToEcf:f,eciToGeodetic:function(o,t){for(var s=6378.137,e=Math.sqrt(o.x*o.x+o.y*o.y),a=.0033528106718309306,n=2*a-a*a,d=Math.atan2(o.y,o.x)-t;d<-Ho;)d+=Yo;for(;Ho<d;)d-=Yo;for(var i,r=0,c=Math.atan2(o.z,Math.sqrt(o.x*o.x+o.y*o.y));r<20;)i=1/Math.sqrt(1-n*(Math.sin(c)*Math.sin(c))),c=Math.atan2(o.z+s*i*n*Math.sin(c),e),r+=1;return{longitude:d,latitude:c,height:e/Math.cos(c)-s*i}},eciToEcf:function(o,t){return{x:o.x*Math.cos(t)+o.y*Math.sin(t),y:o.x*-Math.sin(t)+o.y*Math.cos(t),z:o.z}},ecfToEci:function(o,t){return{x:o.x*Math.cos(t)-o.y*Math.sin(t),y:o.x*Math.sin(t)+o.y*Math.cos(t),z:o.z}},ecfToLookAngles:function(o,t){var s,e,a,n,d,i,r,c,h,m,p,l,x,g,M=(e=t,a=(s=o).longitude,n=s.latitude,d=f(s),i=e.x-d.x,r=e.y-d.y,c=e.z-d.z,{topS:Math.sin(n)*Math.cos(a)*i+Math.sin(n)*Math.sin(a)*r-Math.cos(n)*c,topE:-Math.sin(a)*i+Math.cos(a)*r,topZ:Math.cos(n)*Math.cos(a)*i+Math.cos(n)*Math.sin(a)*r+Math.sin(n)*c});return m=(h=M).topS,p=h.topE,l=h.topZ,x=Math.sqrt(m*m+p*p+l*l),g=Math.asin(l/x),{azimuth:Math.atan2(-p,m)+Ho,elevation:g,rangeSat:x}}}});
