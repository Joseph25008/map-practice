EzMap.Control.LayerSwitcher = OpenLayers.Class(OpenLayers.Control, { autoActivate: !0, element: null, prefix: "", separator: ", ", suffix: "", numDigits: 5, granularity: 10, emptyString: null, lastXy: null, root: "", displayProjection: null, map: null, baseLayers: [], baseLayerId: "", mname: "", dcz: 5, debug: !1, mm: null, isEasymap5_mapini: !1, initialize: function () { OpenLayers.Control.prototype.initialize.apply(this, arguments) }, destroy: function () { this.deactivate(), OpenLayers.Control.prototype.destroy.apply(this, arguments) }, activate: function () { return OpenLayers.Control.prototype.activate.apply(this, arguments) ? (this.map.events.register("mousemove", this, this.redraw), this.map.events.register("mouseout", this, this.reset), this.redraw(), !0) : !1 }, deactivate: function () { }, setMM: function (e) { this.mm = e }, setMap: function (e) { this.map = e }, setbaseLayers: function (e) { var t = new Array; isArray(e) ? t = e : t.push(e), this.baseLayers = e }, addLayer: function (e) { this.baseLayers.push(e), this.addItem(e), this.baseLayerId == e.options.name && this.changeBaseLayer(e) }, setRoot: function (e) { this.root = e }, setDcz: function (e) { this.dcz = e }, easymap5_select: function () { var e = document.getElementById("_EZMAP6_INNERUSED_IDSYS_EZ5_SW_MAP_SLT"), t = e.options[e.selectedIndex].value, a = this.getLayerById(t); this.changeBaseLayer(a) }, addItem_ez5: function (e) { var t = document.getElementById("_EZMAP6_INNERUSED_IDSYS_EZ5_SW_MAP_SLT"), a = document.createElement("option"); a.value = e.id, a.text = e.options.chname, t.add(a) }, addItem: function (e) { if (this.isEasymap5_mapini) return void this.addItem_ez5(e); var t = e.options, a = ""; a += t.name == this.mname ? "<a class='selectLayer' href='javascript:void(0);'>" : "<a href='javascript:void(0);'>"; var s = this.root + t.iconMin; a += is_ie ? "<img src='" + s + "' border=0 width=24 height=18 />&nbsp;" : "<img src='" + s + "' style='margin-bottom:-4px;' border=0 width=24 height=18 />&nbsp;", a += t.chname + "</a>"; var i = document.createElement("li"); i.innerHTML = a, i.title = e.id; var n = this, r = function (e) { var t = ""; t = is_ie ? this.title : e.currentTarget.title; var a = n.getLayerById(t); n.changeBaseLayer(a), document.getElementById("dropdown-1").style.display = "none" }; is_ie || i.addEventListener("touchstart", r, !1), i.onclick = r, this.element.childNodes[1].childNodes[0].appendChild(i) }, easymap5_init: function () { var e = this, t = document.createElement("div"); return t.id = "_EZMAP6_INNERUSED_IDSYS_EZ5_SW_MAP_", t.innerHTML = "<select id='_EZMAP6_INNERUSED_IDSYS_EZ5_SW_MAP_SLT'></select>", t.style.zIndex = "999999", t.style.position = "absolute", t.onchange = function (t) { e.easymap5_select(t) }, this.map.div.insertBefore(t, this.map.div.childNodes[0]), this.mm.resizeTo(), this.element = OpenLayers.Util.createDiv("_ERIC_LAYERSWITCHER_"), this.element.style.display = "none", this.element }, draw: function () { if (this.isEasymap5_mapini) return this.easymap5_init(); for (var e = null, t = 0; t < this.baseLayers.length; t++) { var a = this.baseLayers[t].options; if (a.name == this.mname) { e = this.baseLayers[t]; break } } var s = ""; s = e ? this.root + e.options.iconMax : "", OpenLayers.Control.prototype.draw.apply(this, arguments); var i = this, n = "_ERIC_IMG_", r = s, o = new OpenLayers.Size(80, 90), d = new OpenLayers.Pixel(5, 5), l = "absolute", h = "", m = OpenLayers.Util.createImage(n, d, o, r, l, h); m.setAttribute("data-dropdown", "#dropdown-1"), m.onclick = this.show, is_ie || m.addEventListener("touchstart", function () { i.show() }, !1); var p = OpenLayers.Util.createDiv("dropdown-1"); p.style.display = "none", p.className = "dropdown dropdown-relative dropdown-tip has-icons dropdown-anchor-right easymap-animated fadeOutDown"; var c = document.createElement("ul"); c.id = "dropdown-menu-id", c.className = "dropdown-menu-easymap"; this.map; return p.appendChild(c), this.element = OpenLayers.Util.createDiv("_ERIC_LAYERSWITCHER_"), this.element.appendChild(m), this.element.appendChild(p), this.element.style.display = "none", this.element.className = this.CLASS_NAME.replace(".", "").replace(".", ""), this.element }, setMName: function (e) { this.mname = e }, removeLayer: function (e) { e.id == this.baseLayerId && (this.map.removeLayer(e.instance), this.baseLayers.length > 0 && this.changeBaseLayer(this.baseLayers[0])); for (var t = 0; t < this.baseLayers.length; t++) { var a = this.baseLayers[t]; if (e.id == a.id) { this.baseLayers.indexPop(t); break } } for (var s = this.element.childNodes[1].childNodes[0].childNodes, t = 0; t < s.length; t++) { var i = s[t]; e.id == i.title && this.element.childNodes[1].childNodes[0].removeChild(i) } }, changeBaseLayer: function (e) { var t = e; null == t && this.debug && console.error(MM.EasymapErr + "尚未指定任何底圖"); { var a = t.options; a.name } if (t) { if (this.map.getLayersByName(this.baseLayerId).length > 0) { var s = this.map.getLayersByName(this.baseLayerId)[0]; null != this.map.getLayer(s.id) && this.map.removeLayer(s) } this.map.addLayer(t.instance), this.map.setLayerIndex(t.instance, 0), this.isEasymap5_mapini || (document.getElementById("_ERIC_IMG_").src = this.root + a.iconMax), this.baseLayerId = e.id } for (var i = document.getElementById("dropdown-menu-id"), n = 0; null != i && n < i.childNodes.length; n++) i.childNodes[n].childNodes[0].className = "", i.childNodes[n].title == t.id && (i.childNodes[n].childNodes[0].className = "selectLayer"); if (this.map.getControlsByClass("MM.Control.LTOverviewMap").length >= 1) { var r = this.map.getControlsByClass("MM.Control.LTOverviewMap")[0], o = this.mm.getDgSource(t), d = { layers: [o] }, l = new EzMap.Control.LTOverviewMap(d); l.minRatio = this.dcz, l.maxRatio = this.dcz, this.map.removeControl(r), this.map.addControl(l) } this.map.resetLayersZIndex() }, getLayerById: function (e) { for (var t = 0; t < this.baseLayers.length; t++) if (this.baseLayers[t].id == e) return this.baseLayers[t]; return null }, show: function () { var e = (document.getElementById("_ERIC_IMG_"), document.getElementById("dropdown-1")); e.style.display = "" == e.style.display ? "none" : "", is_ie ? (e.style.left = "-80px", e.style.top = "110px") : (e.style.left = "-105px", e.style.top = "100px") }, redraw: function (e) { return }, reset: function () { }, formatOutput: function (e) { return }, CLASS_NAME: "MM.Control.LayerSwitcher" });