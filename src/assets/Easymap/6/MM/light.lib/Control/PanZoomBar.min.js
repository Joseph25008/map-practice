OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:!1,panIcons:!0,forceFixedZoomLevel:!1,mouseDragStart:null,deltaY:null,zoomStart:null,destroy:function(){this._removeZoomBar(),this.map.events.un({changebaselayer:this.redraw,updatesize:this.redraw,scope:this}),OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments),delete this.mouseDragStart,delete this.zoomStart},setMap:function(){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments),this.map.events.on({changebaselayer:this.redraw,updatesize:this.redraw,scope:this})},redraw:function(){null!=this.div&&(this.removeButtons(),this._removeZoomBar()),this.draw()},draw:function(t){OpenLayers.Control.prototype.draw.apply(this,arguments),t=this.position.clone(),this.buttons=[];var o={w:18,h:18};if(this.panIcons){var e=new OpenLayers.Pixel(t.x+o.w/2,t.y),s=o.w;this.zoomWorldIcon&&(e=new OpenLayers.Pixel(t.x+o.w,t.y)),this._addButton("panup","north-mini.png",e,o),t.y=e.y+o.h,this._addButton("panleft","west-mini.png",t,o),this.zoomWorldIcon&&(this._addButton("zoomworld","zoom-world-mini.png",t.add(o.w,0),o),s*=2),this._addButton("panright","east-mini.png",t.add(s,0),o),this._addButton("pandown","south-mini.png",e.add(0,2*o.h),o),this._addButton("zoomin","zoom-plus-mini.png",e.add(0,3*o.h+5),o),e=this._addZoomBar(e.add(0,4*o.h+5)),this._addButton("zoomout","zoom-minus-mini.png",e,o)}else this._addButton("zoomin","zoom-plus-mini.png",t,o),e=this._addZoomBar(t.add(0,o.h)),this._addButton("zoomout","zoom-minus-mini.png",e,o),this.zoomWorldIcon&&(e=e.add(0,o.h+3),this._addButton("zoomworld","zoom-world-mini.png",e,o));return this.div},_addZoomBar:function(t){var o=OpenLayers.Util.getImageLocation("slider.png"),e=this.id+"_"+this.map.id,s=this.map.getMinZoom(),i=this.map.getNumZoomLevels()-1-this.map.getZoom(),a=OpenLayers.Util.createAlphaImageDiv(e,t.add(-1,i*this.zoomStopHeight),{w:20,h:9},o,"absolute");a.style.cursor="move",this.slider=a,this.sliderEvents=new OpenLayers.Events(this,a,null,!0,{includeXY:!0}),this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});var n={w:this.zoomStopWidth,h:this.zoomStopHeight*(this.map.getNumZoomLevels()-s)},o=OpenLayers.Util.getImageLocation("zoombar.png"),r=null;if(OpenLayers.Util.alphaHack()){var e=this.id+"_"+this.map.id;r=OpenLayers.Util.createAlphaImageDiv(e,t,{w:n.w,h:this.zoomStopHeight},o,"absolute",null,"crop"),r.style.height=n.h+"px"}else r=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,t,n,o);return r.style.cursor="pointer",r.className="olButton",this.zoombarDiv=r,this.div.appendChild(r),this.startTop=parseInt(r.style.top),this.div.appendChild(a),this.map.events.register("zoomend",this,this.moveZoomBar),t=t.add(0,this.zoomStopHeight*(this.map.getNumZoomLevels()-s))},_removeZoomBar:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp}),this.sliderEvents.destroy(),this.div.removeChild(this.zoombarDiv),this.zoombarDiv=null,this.div.removeChild(this.slider),this.slider=null,this.map.events.unregister("zoomend",this,this.moveZoomBar)},onButtonClick:function(t){if(OpenLayers.Control.PanZoom.prototype.onButtonClick.apply(this,arguments),t.buttonElement===this.zoombarDiv){var o=t.buttonXY.y/this.zoomStopHeight;(this.forceFixedZoomLevel||!this.map.fractionalZoom)&&(o=Math.floor(o));var e=this.map.getNumZoomLevels()-1-o;e=Math.min(Math.max(e,0),this.map.getNumZoomLevels()-1),this.map.zoomTo(e)}},passEventToSlider:function(t){this.sliderEvents.handleBrowserEvent(t)},zoomBarDown:function(t){(OpenLayers.Event.isLeftClick(t)||OpenLayers.Event.isSingleTouch(t))&&(this.map.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this}),this.mouseDragStart=t.xy.clone(),this.zoomStart=t.xy.clone(),this.div.style.cursor="move",this.zoombarDiv.offsets=null,OpenLayers.Event.stop(t))},zoomBarDrag:function(t){if(null!=this.mouseDragStart){var o=this.mouseDragStart.y-t.xy.y,e=OpenLayers.Util.pagePosition(this.zoombarDiv);if(t.clientY-e[1]>0&&t.clientY-e[1]<parseInt(this.zoombarDiv.style.height)-2){var s=parseInt(this.slider.style.top)-o;this.slider.style.top=s+"px",this.mouseDragStart=t.xy.clone()}this.deltaY=this.zoomStart.y-t.xy.y,OpenLayers.Event.stop(t)}},zoomBarUp:function(t){if((OpenLayers.Event.isLeftClick(t)||"touchend"===t.type)&&this.mouseDragStart){this.div.style.cursor="",this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var o=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(o+=this.deltaY/this.zoomStopHeight,o=Math.min(Math.max(o,0),this.map.getNumZoomLevels()-1)):(o+=this.deltaY/this.zoomStopHeight,o=Math.max(Math.round(o),0)),this.map.zoomTo(o),this.mouseDragStart=null,this.zoomStart=null,this.deltaY=0,OpenLayers.Event.stop(t)}},moveZoomBar:function(){var t=(this.map.getNumZoomLevels()-1-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=t+"px"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"});