OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,lastTouchPx:null,initialize:function(t,e,s){s&&s.layerOptions&&s.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})),OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;var t=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);return this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,t),this.map.addLayer(this.layer),!0},createFeature:function(t){var e=this.layer.getLonLatFromViewPortPx(t),s=new OpenLayers.Geometry.Point(e.lon,e.lat);this.point=new OpenLayers.Feature.Vector(s),this.callback("create",[this.point.geometry,this.point]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.cancel(),null!=this.layer.map&&(this.destroyFeature(!0),this.layer.destroy(!1)),this.layer=null,!0):!1},destroyFeature:function(t){!this.layer||!t&&this.persist||this.layer.destroyFeatures(),this.point=null},destroyPersistedFeature:function(){var t=this.layer;t&&t.features.length>1&&this.layer.features[0].destroy()},finalize:function(t){var e=t?"cancel":"done";this.mouseDown=!1,this.lastDown=null,this.lastUp=null,this.lastTouchPx=null,this.callback(e,[this.geometryClone()]),this.destroyFeature(t)},cancel:function(){this.finalize(!0)},click:function(t){return OpenLayers.Event.stop(t),!1},dblclick:function(t){return OpenLayers.Event.stop(t),!1},modifyFeature:function(t){this.point||this.createFeature(t);var e=this.layer.getLonLatFromViewPortPx(t);this.point.geometry.x=e.lon,this.point.geometry.y=e.lat,this.callback("modify",[this.point.geometry,this.point,!1]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var t=this.point&&this.point.geometry;return t&&this.multi&&(t=new OpenLayers.Geometry.MultiPoint([t])),t},geometryClone:function(){var t=this.getGeometry();return t&&t.clone()},mousedown:function(t){return this.down(t)},touchstart:function(t){return this.startTouch(),this.lastTouchPx=t.xy,this.down(t)},mousemove:function(t){return this.move(t)},touchmove:function(t){return this.lastTouchPx=t.xy,this.move(t)},mouseup:function(t){return this.up(t)},touchend:function(t){return t.xy=this.lastTouchPx,this.up(t)},down:function(t){return this.mouseDown=!0,this.lastDown=t.xy,this.touch||this.modifyFeature(t.xy),this.stoppedDown=this.stopDown,!this.stopDown},move:function(t){return this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(t.xy),!0},up:function(t){return this.mouseDown=!1,this.stoppedDown=this.stopDown,this.checkModifiers(t)?this.lastUp&&this.lastUp.equals(t.xy)?!0:this.lastDown&&this.passesTolerance(this.lastDown,t.xy,this.pixelTolerance)?(this.touch&&this.modifyFeature(t.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=t.xy,this.finalize(),!this.stopUp):!0:!0},mouseout:function(t){OpenLayers.Util.mouseLeft(t,this.map.viewPortDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(t,e,s){var i=!0;if(null!=s&&t&&e){var n=t.distanceTo(e);n>s&&(i=!1)}return i},CLASS_NAME:"OpenLayers.Handler.Point"});