function CoordTrans(){this.TM2_67="TM2_67",this.TM2_97="TM2_97",this.TWD67="TWD67",this.TWD97="TWD97",this.WGS84="WGS84",this.fromCoord="",this.x="",this.y="",this.from=function(t,D,_){this.x=parseFloat(t),this.y=parseFloat(D),this.fromCoord=_},this.toTM2_67=function(){var t=[];switch(this.fromCoord){case this.TM2_97:var D=fromTM2(TWD97_A,TWD97_ECC,TWD97_ECC2,0,121,TWD97_TM2,this.x,this.y),_=D[0],T=D[1],s=toTWD67(_,T,0),W=s[0],a=s[1];h=toTM2(TWD67_A,TWD67_ECC,TWD67_ECC2,0,121,TWD67_TM2,W,a),t[0]=h[0],t[1]=h[1];break;case this.TM2_67:t[0]=this.x,t[1]=this.y;break;case this.TWD67:var W=this.x,a=this.y;t=toTM2(TWD67_A,TWD67_ECC,TWD67_ECC2,0,121,TWD67_TM2,W,a);break;case this.TWD97:case this.WGS84:default:var _=this.x,T=this.y;s=toTWD67(_,T,0),W=s[0],a=s[1];var h=toTM2(TWD67_A,TWD67_ECC,TWD67_ECC2,0,121,TWD67_TM2,W,a);t[0]=h[0],t[1]=h[1]}var i={};try{i.lon=t[0],i.lat=t[1],i.x=t[0],i.y=t[1]}catch(r){return null}return i},this.toTM2_97=function(){var t=[];switch(this.fromCoord){case this.TM2_97:t[0]=this.x,t[1]=this.y;break;case this.TM2_67:x2=this.x,y2=this.y,p1=fromTM2(TWD67_A,TWD67_ECC,TWD67_ECC2,0,121,TWD67_TM2,x2,y2),D=p1[0],_=p1[1],p3=toTWD97(D,_,0),W=p3[0],a=p3[1],t=toTM2(TWD97_A,TWD97_ECC,TWD97_ECC2,0,121,TWD97_TM2,W,a);break;case this.TWD67:var D=this.x,_=this.y,T=this.x,s=this.y;p2=toTM2(TWD67_A,TWD67_ECC,TWD67_ECC2,0,121,TWD67_TM2,D,_),x2=p2[0],y2=p2[1],p3=toTWD97(T,s,0),W=p3[0],a=p3[1],t=toTM2(TWD97_A,TWD97_ECC,TWD97_ECC2,0,121,TWD97_TM2,W,a);break;case this.TWD97:case this.WGS84:default:var W=this.x,a=this.y;t=toTM2(TWD97_A,TWD97_ECC,TWD97_ECC2,0,121,TWD97_TM2,W,a)}var h={};try{h.lon=t[0],h.lat=t[1],h.x=t[0],h.y=t[1]}catch(i){return null}return h},this.toTWD67=function(){var t=[];switch(this.fromCoord){case this.TM2_97:var D=this.x,_=this.y;p3=fromTM2(TWD97_A,TWD97_ECC,TWD97_ECC2,0,121,TWD97_TM2,D,_),W=p3[0],a=p3[1],t=toTWD67(W,a,0);break;case this.TM2_67:var T=this.x,s=this.y;t=fromTM2(TWD67_A,TWD67_ECC,TWD67_ECC2,0,121,TWD67_TM2,T,s);break;case this.TWD67:t[0]=this.x,t[1]=this.y;break;case this.TWD97:case this.WGS84:var W=this.x,a=this.y;t=toTWD67(W,a,0)}var h={};try{h.lon=t[0],h.lat=t[1],h.x=t[0],h.y=t[1]}catch(i){return null}return h},this.toWGS84=function(){var t=[];switch(this.fromCoord){case this.TM2_97:t=fromTM2(TWD97_A,TWD97_ECC,TWD97_ECC2,0,121,TWD97_TM2,this.x,this.y);break;case this.TM2_67:var D=fromTM2(TWD67_A,TWD67_ECC,TWD67_ECC2,0,121,TWD67_TM2,this.x,this.y),_=toTWD97(D[0],D[1],0);t[0]=_[0],t[1]=_[1];break;case this.TWD67:var T=this.x,s=this.y,W=this.x,a=this.y;_=toTM2(TWD67_A,TWD67_ECC,TWD67_ECC2,0,121,TWD67_TM2,T,s),x2=_[0],y2=_[1],t=toTWD97(W,a,0);break;case this.TWD97:case this.WGS84:default:t[0]=this.x,t[1]=this.y}var h={};try{h.lon=t[0],h.lat=t[1],h.x=t[0],h.y=t[1]}catch(i){return null}return h},this.toTWD97=function(){return this.toWGS84()}}function mercator(t,D,_){return 0==t?0:D*((1-_/4-3*_*_/64-5*_*_*_/256)*t-(3*_/8+3*_*_/32+45*_*_*_/1024)*Math.sin(2*t)+(15*_*_/256+45*_*_*_/1024)*Math.sin(4*t)-35*_*_*_/3072*Math.sin(6*t))}function toTWD67(t,D,_){var T,s,W,a,h,i,r,M,o,C,e,A,n,E,c,y,x,f,R,u,p,l,G,I;if(i=t*DEG_RAD,h=D*DEG_RAD,r=_*DEG_RAD,h<-HALF_PI&&h>-1.001*HALF_PI)h=-HALF_PI;else if(h>HALF_PI&&h<1.001*HALF_PI)h=HALF_PI;else if(h<-HALF_PI||h>HALF_PI)return;if(i>PI&&(i-=2*PI),W=Math.sin(h),a=Math.cos(h),T=TWD97_A/Math.sqrt(1-TWD97_ECC*W*W),M=(T+r)*a*Math.cos(i),o=(T+r)*a*Math.sin(i),C=(T*(1-TWD97_ECC)+r)*W,e=M-TWD67_DX-TWD67_S*(i+TWD67_RZ*h-TWD67_RY*r),A=o-TWD67_DY-TWD67_S*(-TWD67_RZ*i+h+TWD67_RX*r),n=C-TWD67_DZ-TWD67_S*(TWD67_RY*i-TWD67_RX*h+r),s=0,0!=e)i=Math.atan2(A,e);else if(A>0)i=HALF_PI;else if(0>A)i=-HALF_PI;else if(s=1,i=0,n>0)h=HALF_PI;else{if(!(0>n))return h=HALF_PI,xx=i*RAD_DEG,yy=h*RAD_DEG,zz=-TWD67_B,[xx,yy,zz];h=-HALF_PI}return c=e*e+A*A,E=Math.sqrt(c),y=n*AD_C,f=Math.sqrt(y*y+c),p=y/f,l=E/f,x=n+TWD67_B*TWD67_ECC2*p*p*p,u=E-TWD67_A*TWD67_ECC*l*l*l,R=Math.sqrt(x*x+u*u),G=x/R,I=u/R,T=TWD67_A/Math.sqrt(1-TWD67_ECC*G*G),r=I>=COS67_5?E/I-T:I<=-COS67_5?E/-I-T:n/G+T*(TWD67_ECC-1),s||(h=Math.atan(G/I)),xx=i*RAD_DEG,yy=h*RAD_DEG,zz=r,[xx,yy,zz]}function toTM2(t,D,_,T,s,W,a,h){var i,r,M,o,C,e,A,n,E,c;return i=a*DEG_RAD,r=h*DEG_RAD,M=s*DEG_RAD,o=T*DEG_RAD,C=mercator(o,t,D),e=mercator(r,t,D),A=t/Math.sqrt(1-D*Math.pow(Math.sin(r),2)),n=Math.pow(Math.tan(r),2),E=_*Math.pow(Math.cos(r),2),c=(i-M)*Math.cos(r),xx=W*A*(c+(1-n+E)*c*c*c/6+(5-18*n+n*n+72*E-58*_)*Math.pow(c,5)/120)+25e4,yy=W*(e-C+A*Math.tan(r)*(c*c/2+(5-n+9*E+4*E*E)*Math.pow(c,4)/24+(61-58*n+n*n+600*E-330*_)*Math.pow(c,6)/720)),[xx,yy]}function fromTM2(t,D,_,T,s,W,a,h){var i,r,M,o,C,e,A,n,E,c,y,x,f,R;return i=a-dx,r=h,M=s*DEG_RAD,o=T*DEG_RAD,A=mercator(o,t,D),e=A+r/W,E=(1-Math.sqrt(1-D))/(1+Math.sqrt(1-D)),n=e/(t*(1-D/4-3*D*D/64-5*D*D*D/256)),C=n+(3*E/2-27*Math.pow(E,3)/32)*Math.sin(2*n)+(21*E*E/16-55*Math.pow(E,4)/32)*Math.sin(4*n)+151*Math.pow(E,3)/96*Math.sin(6*n)+1097*Math.pow(E,4)/512*Math.sin(8*n),c=_*Math.pow(Math.cos(C),2),y=Math.pow(Math.tan(C),2),x=t/Math.sqrt(1-D*Math.pow(Math.sin(C),2)),f=t*(1-D)/Math.pow(1-D*Math.pow(Math.sin(C),2),1.5),R=i/(x*W),xx=(M+(R-(1+2*y+c)*Math.pow(R,3)/6+(5-2*c+28*y-3*c*c+8*_+24*y*y)*Math.pow(R,5)/120)/Math.cos(C))*RAD_DEG,yy=(C-x*Math.tan(C)/f*(R*R/2-(5+3*y+10*c-4*c*c-9*_)*Math.pow(R,4)/24+(61+90*y+298*c+45*y*y-252*_-3*c*c)*Math.pow(R,6)/72))*RAD_DEG,[xx,yy]}function toTWD97(t,D,_){var T,s,W,a,h,i,r,M,o,C,e,A,n,E,c,y,x,f,R,u,p,l,G,I;if(i=t*DEG_RAD,h=D*DEG_RAD,r=_*DEG_RAD,h<-HALF_PI&&h>-1.001*HALF_PI)h=-HALF_PI;else if(h>HALF_PI&&h<1.001*HALF_PI)h=HALF_PI;else if(h<-HALF_PI||h>HALF_PI)return;if(i>PI&&(i-=2*PI),W=Math.sin(h),a=Math.cos(h),T=TWD67_A/Math.sqrt(1-TWD67_ECC*W*W),M=(T+r)*a*Math.cos(i),o=(T+r)*a*Math.sin(i),C=(T*(1-TWD67_ECC)+r)*W,e=M+TWD67_DX+TWD67_S*(i+TWD67_RZ*h-TWD67_RY*r),A=o+TWD67_DY+TWD67_S*(-TWD67_RZ*i+h+TWD67_RX*r),n=C+TWD67_DZ+TWD67_S*(TWD67_RY*i-TWD67_RX*h+r),s=0,0!=e)i=Math.atan2(A,e);else if(A>0)i=HALF_PI;else if(0>A)i=-HALF_PI;else if(s=1,i=0,n>0)h=HALF_PI;else{if(!(0>n))return h=HALF_PI,t=i*RAD_DEG,D=h*RAD_DEG,void(_=-TWD97_B);h=-HALF_PI}return c=e*e+A*A,E=Math.sqrt(c),y=n*AD_C,f=Math.sqrt(y*y+c),p=y/f,l=E/f,x=n+TWD97_B*TWD97_ECC2*p*p*p,u=E-TWD97_A*TWD97_ECC*l*l*l,R=Math.sqrt(x*x+u*u),G=x/R,I=u/R,T=TWD97_A/Math.sqrt(1-TWD97_ECC*G*G),r=I>=COS67_5?E/I-T:I<=-COS67_5?E/-I-T:n/G+T*(TWD97_ECC-1),s||(h=Math.atan(G/I)),xx=i*RAD_DEG,yy=h*RAD_DEG,zz=r,[xx,yy,zz]}COS67_5=.3826834323650898,PI=3.141592653589793,HALF_PI=1.5707963267948966,DEG_RAD=.017453292519943295,RAD_DEG=57.29577951308232,AD_C=1.0026,TWD67_A=6378160,TWD67_B=6356774.7192,TWD67_ECC=.00669454185458,TWD67_ECC2=.00673966079586,TWD67_DX=-752.32,TWD67_DY=-361.32,TWD67_DZ=-180.51,TWD67_RX=-117e-8,TWD67_RY=184e-8,TWD67_RZ=9.8e-7,TWD67_S=2329e-8,TWD97_A=6378137,TWD97_B=6356752.3141,TWD97_ECC=.0066943800229,TWD97_ECC2=.00673949677556,TWD67_TM2=.9999,TWD97_TM2=.9999,dx=25e4;